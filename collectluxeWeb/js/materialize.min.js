$.fn.material_select=function(w){function m(i,e,t){var n=i.indexOf(e),o=-1===n;return o?i.push(e):i.splice(n,1),t.siblings("ul.dropdown-content").find("li:not(.optgroup)").eq(e).toggleClass("active"),t.find("option").eq(e).prop("selected",o),function(i,e){for(var t="",n=0,o=i.length;n<o;n++){var s=e.find("option").eq(i[n]).text();t+=0===n?s:", "+s}""===t&&(t=e.find("option:disabled").eq(0).text());e.siblings("input.select-dropdown").val(t)}(i,t),o}$(this).each(function(){var n=$(this);if(!n.hasClass("browser-default")){var r=!!n.attr("multiple"),i=n.data("select-id");if(i&&(n.parent().find("span.caret").remove(),n.parent().find("input").remove(),n.unwrap(),$("ul#select-options-"+i).remove()),"destroy"!==w){var e=Materialize.guid();n.data("select-id",e);var t=$('<div class="select-wrapper"></div>');t.addClass(n.attr("class"));function o(i,e,t){var n=e.is(":disabled")?"disabled ":"",o="optgroup-option"===t?"optgroup-option ":"",s=r?'<input type="checkbox"'+n+"/><label></label>":"",l=e.data("icon"),a=e.attr("class");if(l){var d="";return a&&(d=' class="'+a+'"'),c.append($('<li class="'+n+o+'"><img alt="" src="'+l+'"'+d+"><span>"+s+e.html()+"</span></li>")),!0}c.append($('<li class="'+n+o+'"><span>'+s+e.html()+"</span></li>"))}var c=$('<ul id="select-options-'+e+'" class="dropdown-content select-dropdown '+(r?"multiple-select-dropdown":"")+'"></ul>'),s=n.children("option, optgroup"),l=[],a=!1,d=n.find("option:selected").html()||n.find("option:first").html()||"";s.length&&s.each(function(){if($(this).is("option"))r?o(0,$(this),"multiple"):o(0,$(this));else if($(this).is("optgroup")){var i=$(this).children("option");c.append($('<li class="optgroup"><span>'+$(this).attr("label")+"</span></li>")),i.each(function(){o(0,$(this),"optgroup-option")})}});var p=!1;c.find("li:not(.optgroup)").each(function(t){$(this).click(function(i){if(p)i.stopPropagation();else{if(p=!0,!$(this).hasClass("disabled")&&!$(this).hasClass("optgroup")){var e=!0;r?($('input[type="checkbox"]',this).prop("checked",function(i,e){return!e}),e=m(l,t,n),h.trigger("mtr-focus")):(c.find("li").removeClass("active"),$(this).toggleClass("active"),h.val($(this).text())),g(c,$(this)),n.find("option").eq(t).prop("selected",e),n.trigger("change"),void 0!==w&&w()}i.stopPropagation(),h.trigger("close"),setTimeout(function(){p=!1},800)}})}),n.wrap(t);var f=$('<span class="caret">&#9660;</span>');n.is(":disabled")&&f.addClass("disabled");var u=d.replace(/"/g,"&quot;"),h=$('<input type="text" class="select-dropdown" readonly="true" '+(n.is(":disabled")?"disabled":"")+' data-activates="select-options-'+e+'" value="'+u+'"/>');n.before(h),h.before(f),h.after(c),n.is(":disabled")||h.dropdown({hover:!1,closeOnClick:!1}),n.attr("tabindex")&&$(h[0]).attr("tabindex",n.attr("tabindex")),n.addClass("initialized");var v=!1;h.on({focus:function(){if(v=!0,$(this).blur(),$("ul.select-dropdown").not(c[0]).is(":visible")&&$("input.select-dropdown").trigger("close"),!c.is(":visible")){$(this).trigger("open",["focus"]);var i=$(this).val();r&&0<=i.indexOf(",")&&(i=i.split(",")[0]);var e=c.find("li").filter(function(){return $(this).text().toLowerCase()===i.toLowerCase()})[0];g(c,e,!0)}},click:function(i){i.stopPropagation()}}),h.on("blur",function(){v?v=!1:(r||$(this).trigger("close"),c.find("li.selected").removeClass("selected"))}),c.hover(function(){a=!0},function(){a=!1}),$(window).on({click:function(){r&&(a||h.trigger("close"))}}),r&&n.find("option:selected:not(:disabled)").each(function(){var i=$(this).index();m(l,i,n),c.find("li").eq(i).find(":checkbox").prop("checked",!0)});var g=function(i,e,t){if(e){i.find("li.selected").removeClass("selected");var n=$(e);n.addClass("selected"),r&&!t||c.scrollTo(n)}},b=[];h.on("keydown",function(i){if(9!=i.which)if(40!=i.which||c.is(":visible")){if(13!=i.which||c.is(":visible")){i.preventDefault();var e=String.fromCharCode(i.which).toLowerCase();if(e&&-1===[9,13,27,38,40].indexOf(i.which)){b.push(e);var t=b.join(""),n=c.find("li").filter(function(){return 0===$(this).text().toLowerCase().indexOf(t)})[0];n&&g(c,n)}if(13==i.which){var o=c.find("li.selected:not(.disabled)")[0];o&&($(o).trigger("click"),r||h.trigger("close"))}40==i.which&&(n=c.find("li.selected").length?c.find("li.selected").next("li:not(.disabled)")[0]:c.find("li:not(.disabled)")[0],g(c,n)),27==i.which&&h.trigger("close"),38==i.which&&(n=c.find("li.selected").prev("li:not(.disabled)")[0])&&g(c,n),setTimeout(function(){b=[]},1e3)}}else h.trigger("open");else h.trigger("close")})}else n.data("select-id",null).removeClass("initialized")}})},$(document).bind("dofirst",function(i,e){$(e).find('.input-field input:not([type="checkbox"],[type="radio"]), .input-field textarea, .input-field select').bind("update-label-to-active",function(){$(this).val()&&$(this).siblings("label").addClass("active")}).change(function(){$(this).trigger("update-label-to-active")}).trigger("update-label-to-active"),$(e).find(".modal").modal(),$(e).find(".d-collapsible").addClass("collapsible").collapsible(),$(e).find("a.collapsible-header").click(function(i){i.preventDefault()}),$(e).find(".dropdown-button").each(function(){var i=$(this),e=$._data(i[0],"events");(void 0===e||void 0===e.open&&void 0===e.close)&&i.click().dropdown()}),$("html.mobile").find(e).each(function(){var i=$(this),e=i.find('input[type="text"].select-dropdown').on("touchstart",function(){$(this).trigger("focus")});i.find(".dropdown-content li").on("mouseover",function(){0==$(this).find('input[type="checkbox"]').length&&($(this).click(),e.trigger("close"))})})}),$(document).on("touchstart",".dropdown-content",function(i){i.stopPropagation()});