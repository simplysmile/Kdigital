$.fn.dcomment=function(a){return this.each(function(){var t=$(this);if(!t.hasClass("dcomment-installed")){var c=$.extend({txtAuthor:"",txtBtnApply:"",txtBtnCancel:"",txtBtnDelete:"",txtBtnEdit:"",txtBtnPost:"",txtCommentsBody:"",txtMoreComments:"",txtMsgDelete:"",txtPassword:"",url:"",islogin:!1,permCreate:!0,page:1},a,!0);t.empty().addClass("dcomment dcomment-installed");var o=$("<div />").addClass("dcomment-more").appendTo(t).hide(),u=$("<div />").addClass("dcomment-rows list-group").appendTo(t),d=$("<div />").addClass("dcomment-forms").appendTo(t),f=$("<div />").addClass("dcomment-loading").appendTo(t).hide();$("<div />").addClass("screen").appendTo(f),$("<div />").addClass("spinner").appendTo(f).spin(),t.attr("data-txt-author")&&(c.txtAuthor=t.attr("data-txt-author")),t.attr("data-txt-btn-apply")&&(c.txtBtnApply=t.attr("data-txt-btn-apply")),t.attr("data-txt-btn-cancel")&&(c.txtBtnCancel=t.attr("data-txt-btn-cancel")),t.attr("data-txt-btn-delete")&&(c.txtBtnDelete=t.attr("data-txt-btn-delete")),t.attr("data-txt-btn-edit")&&(c.txtBtnEdit=t.attr("data-txt-btn-edit")),t.attr("data-txt-btn-post")&&(c.txtBtnPost=t.attr("data-txt-btn-post")),t.attr("data-txt-comments-body")&&(c.txtCommentsBody=t.attr("data-txt-comments-body")),t.attr("data-txt-more-comments")&&(c.txtMoreComments=t.attr("data-txt-more-comments")),t.attr("data-txt-msg-delete")&&(c.txtMsgDelete=t.attr("data-txt-msg-delete")),t.attr("data-txt-password")&&(c.txtPassword=t.attr("data-txt-password")),t.attr("data-url")&&(c.url=t.attr("data-url")),t.attr("data-islogin")&&(c.islogin="true"==t.attr("data-islogin")),t.attr("data-perm-create")&&(c.permCreate="true"==t.attr("data-perm-create")),c.url&&(function a(t){f.show();$.dpost(c.url+"/page/"+t,function(t){f.hide(),$(t.rows).each(function(){e(this)}),c.permCreate&&0==d.find(".dcomment-form").length&&(v(d,null),location.hash.match(/^#comment-[0-9]+$/)&&$(location.hash).each(function(){var t=$(this);$("html, body").animate({scrollTop:t.offset().top}),t.addClass("blink"),setTimeout(function(){t.removeClass("blink")},3e3)})),t.pagination.total_pages>parseInt(t.pagination.cur_page)?0==o.find("a").length&&$("<a />").attr("href","#").html('<span class="fa fa-comment-o"></span> '+c.txtMoreComments).appendTo(o.show()).click(function(t){t.preventDefault(),a(c.page),c.page++}):o.remove()},"json")}(c.page),c.page++)}function h(t){return 0<$("#comment-"+t.uid).length?null:$("<div />").attr("id","comment-"+t.uid).addClass("dcomment-row list-group-item")}function e(t){var a=h(t);a&&x(a.prependTo(u),t)}function s(t,a,o,d){var e=$("<div />").addClass("row").html("<hr />").appendTo(a),n=$("<div />").addClass("col s8 offset-s2 m6 offset-m3").appendTo(e),s=$("<form />").attr("method","post").attr("action",t).appendTo(n);$('<input type="hidden" name="mode" value="password" />').appendTo(s);var r=$("<div />").addClass("input-group").appendTo(s);$("<div />").addClass("input-group-addon").html('<span class="fa fa-fw fa-lock"></span>').appendTo(r),$("<input />").attr("type","password").attr("name","password").attr("placeholder","비밀번호").appendTo(r).focus();var p=$("<div />").addClass("input-group-btn").appendTo(r);$("<button />").html('<span class="fa fa-fw fa-check"></span>').addClass("btn btn-secondary").appendTo(p),s.dform({submit:function(){return d(s)}})}function x(d,e){var t;d.empty();$("<div />").addClass("dcomment-author right").text(e.name).appendTo(d),$("<div />").addClass("dcomment-body").html(e.body).appendTo(d);var n=$("<div />").addClass("dcomment-info").appendTo(d);$("<span />").addClass("dcore-info-item").html('<span class="fa fa-clock-o"></span> '+e.time).appendTo(n),e.perm_update&&(t=$("<span />").addClass("dcore-info-item func").appendTo(n),$("<a />").attr("href","#").html('<span class="fa fa-pencil-square-o"></span>').attr("data-tooltip-content",c.txtBtnEdit).tooltip().click(function(t){$(this).tooltip("remove"),t.preventDefault();var a=c.url+"/"+e.uid+"/update";function o(t){t.error?$.dtoast(t.error):(t.row.body=$("<div />").html(t.row.body).text(),v(d,t.row),!c.islogin&&"0"==e.uid_user&&t.row.password&&d.find('input[name="password"]').val(t.row.password).parent().hide(),d.find("textarea").focus().select())}c.islogin||"0"!=e.uid_user?(f.show(),$.dget(a,function(t){f.hide(),o(t)},"json")):(n.hide(),s(a,d,0,function(t){return f.show(),$.dpost(t.attr("action"),t.serialize(),function(t){f.hide(),o(t)},"json"),!1}))}).appendTo(t)),e.perm_delete&&(t=$("<span />").addClass("dcore-info-item func").appendTo(n),$("<a />").attr("href","#").html('<span class="fa fa-trash-o"></span>').attr("data-tooltip-content",c.txtBtnDelete).tooltip().click(function(t){$(this).tooltip("remove"),t.preventDefault();var a=c.url+"/"+e.uid+"/delete";function o(t){"__OK__"!=t?$.dtoast(t):d.remove()}c.islogin||"0"!=e.uid_user?$.dconfirm(c.txtMsgDelete,function(){f.show(),$.dpost(a,function(t){f.hide(),o(t)},"text")}):(n.hide(),s(a,d,0,function(t){return f.show(),$.dpost(t.attr("action"),t.serialize(),function(t){f.hide(),o(t)},"text"),!1}))}).appendTo(t))}function v(d,e){d.empty();var t,a,o,n,s,r=$("<div />").addClass("dcomment-form").appendTo(d),p=$("<form />").attr("method","post").attr("action",c.url+(e?"/"+e.uid+"/update":"/create")).appendTo(r);t=$("<div />").addClass("form-group").appendTo(p);var i=$("<textarea />").attr("name","body").attr("rows","1").attr("cols","80").attr("placeholder",c.txtCommentsBody).val(e?e.body:"").addClass("materialize-textarea").appendTo(t).dform();if(n=$("<div />").addClass("row").appendTo(p),!c.islogin){s=$("<div />").addClass("col s4").appendTo(n),t=$("<div />").addClass("form-group").appendTo(s),a=$("<div />").addClass("input-group").appendTo(t),o=$("<div />").addClass("input-group-addon").appendTo(a),$("<span />").addClass("fa fa-user-o").appendTo(o);$("<input />").attr("type","text").attr("name","name").attr("maxlength","255").attr("placeholder",c.txtAuthor).val(e?e.name:"").appendTo(a).dform();s=$("<div />").addClass("col s4").appendTo(n),t=$("<div />").addClass("form-group").appendTo(s),a=$("<div />").addClass("input-group").appendTo(t),o=$("<div />").addClass("input-group-addon").appendTo(a),$("<span />").addClass("fa fa-lock").appendTo(o);$("<input />").attr("type","password").attr("name","password").attr("maxlength","255").attr("placeholder",c.txtPassword).appendTo(a).dform()}s=$("<div />").addClass(c.islogin?"col s12 right-align":"col s2").appendTo(n);var l=$("<button />").attr("type","button").html(c.txtBtnCancel).addClass("button"+(c.islogin?" sm-":" block-")).appendTo(s).dform();c.islogin?s.append(" "):s=$("<div />").addClass("col s2").appendTo(n);var m=$("<button />").attr("type","submit").html(e?c.txtBtnApply:c.txtBtnPost).addClass("button"+(c.islogin?" sm-":" block-")).appendTo(s).dform();n.hide(),i.focus(function(){n.show()}),l.click(function(t){t.preventDefault(),e?x(d,e):v(d,null)}),p.dform({submit:function(){return m.dformIsLoading()||(f.show(),m.dformLoading(),$.dpost(p.attr("action"),p.serialize(),function(t){var a,o;m.dformLoaded(),f.hide(),e?x(d,t.row):(a=t.row,(o=h(a))&&x(o.appendTo(u),a),v(d,e))},"json")),!1}})}})},$(document).bind("dofirst",function(t,a){$(a).find(".dcomment").dcomment()});