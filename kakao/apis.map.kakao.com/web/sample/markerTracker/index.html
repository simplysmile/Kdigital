<!DOCTYPE html><html lang="ko">
<!-- Mirrored from apis.map.kakao.com/web/sample/markerTracker/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 May 2022 05:12:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>지도 영역 밖의 마커위치 추적하기 - Kakao 지도 Web API</title><link href="../../../favicon.ico" rel="shortcut icon"><meta name="viewport" content="width=720"><meta property="og:type" content="website"><meta property="og:title" content="Kakao 지도 API"><meta property="og:description" content="Kakao 지도 API를 이용해보세요. 다양한 샘플과 상세한 매뉴얼로 개발자분들의 시간을 아껴드리겠습니다!"><meta property="og:image" content="../../../../t1.daumcdn.net/localimg/localimages/07/mapapidoc/daumMapsApi.png"><meta property="og:url" content="../../../index.html"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Kakao 지도 API"><meta name="twitter:description" content="Kakao 지도 API를 이용해보세요. 다양한 샘플과 상세한 매뉴얼로 개발자분들의 시간을 아껴드리겠습니다!"><meta name="twitter:image" content="../../../images/daumMapsApiThumb.png"><meta name="twitter:url" content="../../../index.html"><link rel="stylesheet" type="text/css" href="../../../../t1.daumcdn.net/mapapisdoc/cssjs/1643022782389/css/service.min.css"><script type="text/javascript" src="../../../../dapi.kakao.com/v2/maps/sdk23bf.json?appkey=326e38503f420e1f0088dab1f46dc0c7&amp;libraries=services,clusterer,drawing"></script><script type="text/javascript" src="../../../../s1.daumcdn.net/svc/original/U03/cssjs/jquery/jquery-1.11.0.js"></script><script type="text/javascript" src="../../../../s1.daumcdn.net/svc/original/U0301/cssjs/JSON-js/fc535e9cc8/json2.min.js_%3b%20filename_%3dUTF-8%27%27json2.min.js"></script><style>.node {
    position: absolute;
    background-image: url(../../../../t1.daumcdn.net/localimg/localimages/07/mapapidoc/sign-info-64.png);
    cursor: pointer;
    width: 64px;
    height: 64px;
}

.tooltip {
    background-color: #fff;
    position: absolute;
    border: 2px solid #333;
    font-size: 25px;
    font-weight: bold;
    padding: 3px 5px 0;
    left: 65px;
    top: 14px;
    border-radius: 5px;
    white-space: nowrap;
    display: none;
}

.tracker {
    position: absolute;
    margin: -35px 0 0 -30px;
    display: none;
    cursor: pointer;
    z-index: 3;
}

.icon {
    position: absolute;
    left: 6px;
    top: 9px;
    width: 48px;
    height: 48px;
    background-image: url(../../../../t1.daumcdn.net/localimg/localimages/07/mapapidoc/sign-info-48.png);
}

.balloon {
    position: absolute;
    width: 60px;
    height: 60px;
    background-image: url(../../../../t1.daumcdn.net/localimg/localimages/07/mapapidoc/balloon.png);
    -ms-transform-origin: 50% 34px;
    -webkit-transform-origin: 50% 34px;
    transform-origin: 50% 34px;
}</style></head><body class="web sample_snippet" data-page_section="web" data-page_type="sample_snippet" data-title="지도 영역 밖의 마커위치 추적하기"><div id="daumGnb"><h1 id="logo"><a href="../../../index.html"><div class="kakao">Kakao</div>Maps API</a></h1><ul id="gnbMenu"><li id="menuAbout" class=""><a href="../../index.html"><svg viewbox="0 0 86 42"><path fill="#302A24" d="M54.6,26.3l-10.8-11c-0.2-0.2-0.5-0.2-0.8-0.1c-0.2-0.1-0.6-0.1-0.8,0.1l-10.8,11c-0.3,0.3-0.3,0.7,0,1c0.3,0.3,0.7,0.3,0.9,0L43,16.5l10.7,10.8c0.3,0.3,0.7,0.3,0.9,0C54.9,27,54.9,26.6,54.6,26.3z M36,26.1c-0.4,0-0.7,0.3-0.7,0.7v9.4c0,0.4,0.3,0.7,0.7,0.7s0.7-0.3,0.7-0.7v-9.4C36.6,26.4,36.3,26.1,36,26.1z M50,26.1c-0.4,0-0.7,0.3-0.7,0.7v9.4c0,0.4,0.3,0.7,0.7,0.7s0.7-0.3,0.7-0.7v-9.4C50.7,26.4,50.4,26.1,50,26.1z M40.7,28.1c-0.4,0-0.7,0.3-0.7,0.7v6.7h-2.7c-0.4,0-0.7,0.3-0.7,0.7c0,0.4,0.3,0.7,0.7,0.7h3.4c0.4,0,0.7-0.3,0.7-0.7v-7.3C41.3,28.4,41,28.1,40.7,28.1z M48.7,35.5H46v-6.7c0-0.4-0.3-0.7-0.7-0.7H42c-0.4,0-0.7,0.3-0.7,0.7c0,0.4,0.3,0.7,0.7,0.7h2.7v6.7c0,0.4,0.3,0.7,0.7,0.7h3.4c0.4,0,0.7-0.3,0.7-0.7C49.4,35.8,49.1,35.5,48.7,35.5z"></path></svg> About</a></li><li id="menuGuide" class=""><a href="../../guide/index.html"><svg viewbox="0 0 86 42"><path fill="#302A24" d="M52.5,19.4l-6-2.4c-0.3,0-0.5,0.1-0.8,0.2C45.5,17.1,45.3,17,45,17l-6,2.4c-0.3,0-0.5,0.1-0.8,0.2c-0.2-0.1-0.5-0.2-0.7-0.2l-6-2.4c-0.8,0-1.5,0.7-1.5,1.6v15.5c0,0.9,0.7,1.6,1.5,1.6l6,2.4c0.3,0,0.5-0.1,0.7-0.2c0.2,0.1,0.5,0.2,0.8,0.2l6-2.4c0.3,0,0.5-0.1,0.7-0.2c0.2,0.1,0.5,0.2,0.8,0.2l6,2.4c0.8,0,1.5-0.7,1.5-1.6V20.9C54,20.1,53.3,19.4,52.5,19.4z M37.5,36.4l-6-2.4V18.6l6,2.4V36.4z M45,34.1l-6,2.4V20.9l6-2.4V34.1z M52.5,36.4l-6-2.4V18.6l6,2.4V36.4z"></path></svg> Guide</a></li><li id="menuSample" class="selected"><a href="../index.html"><svg viewbox="0 0 86 42"><path fill="#302A24" d="M40.1,32.5l1-1.1l-3.5-4h0.1c-1.5-1.4-2.5-3.3-2.5-5.6c0-4.1,3.3-7.4,7.4-7.4c4.1,0,7.4,3.3,7.4,7.4c0,2.2-1,4.2-2.5,5.6h0.1L42.5,33l0,0l-1,1.1l1,1.2l6.5-7.6c1.4-1.6,2.2-3.6,2.2-5.9c0-4.9-3.9-8.8-8.7-8.8c-4.8,0-8.7,3.9-8.7,8.8c0,2.3,0.9,4.4,2.3,5.9L40.1,32.5z M50.3,32H48l-1,1.4h2.4l2.3,4.2H33.3l2.3-4.2H38L37,32h-2.3L31,39h23L50.3,32z M46.2,21.8c0-2-1.6-3.7-3.7-3.7c-2,0-3.7,1.7-3.7,3.7s1.6,3.7,3.7,3.7C44.5,25.5,46.2,23.9,46.2,21.8z M40.2,21.8c0-1.3,1-2.3,2.3-2.3c1.3,0,2.3,1,2.3,2.3c0,1.3-1,2.3-2.3,2.3C41.2,24.1,40.2,23.1,40.2,21.8z"></path></svg> Sample</a></li><li id="menuDocs" class=""><a href="../../documentation/index.html"><svg viewbox="0 0 86 42"><path fill="#302A24" d="M52.2,16H37c-0.5,0-0.8,0.4-0.8,0.8c0,0.5,0.4,0.8,0.8,0.8h14.3V32c0,0.5,0.4,0.8,0.8,0.8c0.5,0,0.8-0.4,0.8-0.8V16.8C53,16.4,52.6,16,52.2,16z M48.8,19.4H33.7c-0.2,0-0.3,0.1-0.4,0.1c-0.1-0.1-0.3-0.1-0.4-0.1c-0.5,0-0.8,0.4-0.8,0.8v16c0,0.5,0.4,0.8,0.8,0.8h16c0.5,0,0.8-0.4,0.8-0.8v-16C49.6,19.7,49.3,19.4,48.8,19.4z M48,35.3H33.7V21H48V35.3z M37,25.2h7.6c0.5,0,0.8-0.4,0.8-0.8c0-0.5-0.4-0.8-0.8-0.8H37c-0.5,0-0.8,0.4-0.8,0.8C36.2,24.9,36.6,25.2,37,25.2zM37,28.6h7.6c0.5,0,0.8-0.4,0.8-0.8c0-0.5-0.4-0.8-0.8-0.8H37c-0.5,0-0.8,0.4-0.8,0.8C36.2,28.2,36.6,28.6,37,28.6z M37,32h7.6c0.5,0,0.8-0.4,0.8-0.8s-0.4-0.8-0.8-0.8H37c-0.5,0-0.8,0.4-0.8,0.8S36.6,32,37,32z"></path></svg> Docs</a></li><li id="menuWizard" class=""><a href="../../wizard/index.html"><svg viewbox="0 0 86 42"><path fill="#302A24" d="M55.1,39.8c-0.4,0.4-0.9,0.4-1.3,0.1L43.9,30c-0.3-0.3-0.3-0.9,0.1-1.3c0.4-0.4,0.9-0.4,1.3-0.1l9.9,9.9C55.5,38.9,55.5,39.5,55.1,39.8zM52.3,26.8l-7.8,2.4L42,37.1l-4.7-6.7l-8.2,0.1l4.9-6.6l-2.6-7.8l7.8,2.6l6.6-4.9l-0.1,8.2L52.3,26.8zM43.4,28.2l5.9-1.8l-5.1-3.6l0.1-6.2l-5,3.7l-5.9-2l2,5.9l-3.7,5L38,29l3.6,5.1L43.4,28.2z"></path></svg> Wizard</a></li><li id="menuNews" class=""><a href="../../news/index.html"><svg viewbox="0 0 86 42"><path fill="#302A24" d="M45.9,38.5c-0.2,0-0.4-0.1-0.5-0.2l-3.7-3.6h-6.3c-3.6,0-6.5-2.8-6.5-6.2v-6.8c0-3.4,2.9-6.2,6.5-6.2h13.2c3.6,0,6.5,2.8,6.5,6.2v6.8c0,3.3-2.7,6-6.1,6.2l-2.5,3.5C46.4,38.3,46.2,38.4,45.9,38.5C46,38.4,45.9,38.5,45.9,38.5z M35.4,16.8c-2.8,0-5.1,2.1-5.1,4.8v6.8c0,2.6,2.3,4.8,5.1,4.8H42c0.2,0,0.4,0.1,0.5,0.2l3.2,3.1l2.2-3.1c0.1-0.2,0.4-0.3,0.6-0.3c2.8,0,5.1-2.1,5.1-4.8v-6.8c0-2.6-2.3-4.8-5.1-4.8L35.4,16.8L35.4,16.8zM39.2,20.4h1.5l3.7,6l0,0v-6h1.4v8.1h-1.5l-3.7-6l0,0v6h-1.4V20.4z"></path></svg> News</a></li></ul><ul id="gnbLink"><li id="linkQna"><a href="https://devtalk.kakao.com/c/map-api" target="_blank"><svg viewbox="0 0 34.4 31.5"><path fill="#EF4136" d="M21,16.6c-0.6-0.5-0.9-0.8-0.9-0.8s-3.9,2.5-6.6,2.5c-2.6,0-6.6-2.5-6.6-2.5s-2.6,2.5-5.3,3.7c-1.7,0.8-1.8,3.1-1.6,4.7c0,0.1,0,0.2,0,0.3c0,0.4,0.1,0.7,0.3,1.1c0,0.1,0,0.2,0,0.2h0C0.8,26.5,1.6,27,2.6,27H18c-0.3-0.9-0.5-2-0.5-3C17.5,21,18.9,18.4,21,16.6zM8.1,12.1c1.1,1.9,3,3.7,5.4,3.7c2.4,0,4.2-1.8,5.4-3.7h1.2l1.3-3.7l-1.3-1.2c0-0.3,0-0.4-0.1-0.5c0,0,0-0.1,0-0.1c0-0.2,0-0.4-0.1-0.6h0.1c0,0,0.1-2.7-1.3-3.7c-0.2-0.1-0.4-0.2-0.6-0.3C16.9,0.7,15.3,0,13.5,0C11.7,0,10,0.7,8.9,1.9C8.6,2,8.4,2.1,8.2,2.2C7.4,3,7,4.5,6.9,5.9c0,0.4,0,1.1,0,1.2L5.6,8.4l1.3,3.7H8.1z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M27,16.6c4.1,0,7.4,3.3,7.4,7.4s-3.3,7.4-7.4,7.4s-7.4-3.3-7.4-7.4S22.9,16.6,27,16.6z M26.9,29.6c-0.6,0-1.1-0.5-1.1-1.1c0-0.6,0.5-1.1,1.1-1.1s1.1,0.5,1.1,1.1C28,29.1,27.5,29.6,26.9,29.6zM27.9,26.8h-2v-0.1c0-0.9,0.1-1.5,0.3-2c0.2-0.4,0.5-0.8,1.1-1.4l0.5-0.5c0.2-0.2,0.3-0.4,0.4-0.6c0.1-0.2,0.1-0.5,0.1-0.6c0-0.4-0.1-0.8-0.3-1.1c-0.2-0.3-0.6-0.4-1-0.4c-1,0-1.5,0.7-1.5,2.1l0,0.1h-1.9v-0.1c0-1.1,0.3-2.1,0.9-2.7c0.6-0.7,1.5-1,2.5-1c1.1,0,1.9,0.3,2.5,0.9c0.6,0.6,0.8,1.3,0.8,2.2c0,0.6-0.2,1.1-0.5,1.6c-0.2,0.3-0.6,0.7-1.1,1.2c-0.6,0.6-0.9,1.4-0.9,2.4V26.8z"></path></svg> 문의하기</a></li><li id="linkKey"><a href="https://developers.kakao.com/console/app" target="_blank"><svg viewbox="0 0 35 35"><path fill-rule="evenodd" clip-rule="evenodd" fill="#EF4136" d="M17.5,0C27.2,0,35,7.8,35,17.5S27.2,35,17.5,35C7.8,35,0,27.2,0,17.5S7.8,0,17.5,0z M19.1,19.6L15.7,23h-2.2v2.2h-2.2v2.2H7.6v-3.7l7.8-7.9c-0.3-0.7-0.4-1.4-0.4-2.2c0-3.5,2.8-6.3,6.3-6.3s6.3,2.8,6.3,6.3S24.8,20,21.3,20C20.5,20,19.8,19.8,19.1,19.6L19.1,19.6L19.1,19.6z M25.4,11.8c0-1.2-1-2.2-2.2-2.2c-1.2,0-2.2,1-2.2,2.2s1,2.2,2.2,2.2C24.4,14,25.4,13,25.4,11.8L25.4,11.8z"></path></svg> 키발급</a></li><li id="linkWeb" class="selected"><a href="../../index.html"><svg viewbox="0 0 23.7 14.7"><path d="M8.3,12.3L0,8.2V6.2l8.3-4v2.6L3,7.2l5.3,2.6V12.3z M14.5,0L11,14.7H9.1L12.6,0L14.5,0z M23.7,8.2l-8.3,4.1V9.9l5.5-2.7l-5.5-2.8V2.1l8.3,4.1V8.2z"></path></svg> Web</a></li><li id="linkAndroid" class=""><a href="../../../android/index.html"><svg viewbox="0 0 546.1 644.6"><path fill="#25B2DA" d="M546.1,417.1c-0.3,1.3-0.7,2.5-0.9,3.8c-3.2,20.8-21,34.6-43,33.3c-19.1-1.1-35.6-18.1-36-37.7c-0.4-23.5-0.2-47-0.2-70.5c0-32.8-0.2-65.6,0.1-98.4c0.2-19.1,13.5-34.9,31.7-38.6c21.9-4.4,42.7,9.4,47.1,31.2c0.3,1.6,0.8,3.2,1.2,4.8C546.1,302.4,546.1,359.7,546.1,417.1z M273.2,215.9c57.2,0,114.3,0,171.5,0c7.5,0,7.5,0,7.5,7.5c0,82.6,0,165.3,0,247.9c0,23.5-14.6,42.3-36.3,45.3c-9.3,1.3-19,0.5-28.4,0.5c-8.2,0.1-8.2,0-8.2,8.2c0,26.5,0.1,53,0,79.5c-0.1,16.6-9.8,30.5-25.4,36.7c-14.8,5.9-32.1,2.1-43.2-9.6c-7-7.5-10.7-16.3-10.7-26.7c0.1-27,0-54,0-81c0-7-0.2-7.1-6.9-7.1c-13.7,0-27.3,0.2-41-0.1c-4.7-0.1-6,1.6-6,6.1c0.2,27,0.3,54,0,81c-0.2,15.9-7.5,28.3-21.8,35.6c-13.8,7.1-27.8,6.2-40.7-2.6c-12-8.2-17.4-20.3-17.4-34.7c-0.1-25.8,0-51.7,0-77.5c0-7.8,0-7.8-8.1-7.8c-7.2,0-14.3,0-21.5,0c-23.5-0.1-42.5-18.6-42.5-42.1c-0.1-84.3,0-168.6-0.2-252.9c0-5.3,2.1-6.3,6.8-6.3C158.2,216,215.7,215.9,273.2,215.9z M272.6,202c-57,0-113.9,0-170.9,0c-8.6,0-8.3,0-7.9-8.7c1.9-34.5,14.4-64.8,36.4-91.2c13.8-16.5,29.9-30.4,48.9-40.6c5.8-3.1,5.9-3.2,2.7-9.1c-7.4-13.6-14.9-27.1-22.3-40.7c-3.2-5.9-3-9.3,0.1-11.1c3.4-1.8,6-0.1,9.3,5.8c7.8,14.3,15.8,28.6,23.4,43c2.1,4,4.5,3.4,7.8,2.1c23.5-9.8,48.2-14.3,73.6-14.2c24,0.1,47.4,4.4,69.7,13.3c7.7,3.1,7.6,3,11.7-4.5c7.4-13.6,14.9-27.2,22.3-40.7c0.3-0.6,0.6-1.2,1-1.8c1.8-3.2,4.5-4.6,7.9-2.8c3.3,1.8,3.2,4.8,1.6,7.8c-4.8,8.8-9.5,17.6-14.3,26.3c-3.5,6.4-6.9,12.9-10.6,19.2c-1.8,3-1.3,4.6,1.7,6.3c12.2,6.9,23.6,14.8,34.1,24.3c22.8,20.6,38.7,45.5,47.4,75c3.3,11.1,4.8,22.4,5.9,33.9c0.7,7.8,0.3,8.3-7.5,8.3C387.2,202,329.9,202,272.6,202z M339.3,121.7c0,9.3,6,15.4,15.2,15.4c8.6-0.1,15.4-6.7,15.4-15c0-8.3-7.4-15.8-15.6-15.7C345.9,106.5,339.3,113.3,339.3,121.7z M191.2,107.1c-9,0.1-15,6.1-15,15c0,8.6,6.7,15.1,15.3,14.9c8.5-0.2,14.7-6.4,14.7-15C206.2,113,200.2,107,191.2,107.1z M79.3,331.7c0,27.6,0,55.3,0,82.9c0,22.5-17.1,39.6-39.4,39.6c-22.4,0-39.8-17.1-39.8-39.4C0,359.3,0,303.7,0.1,248c0-21.1,15.2-37.6,36.5-39.8c19.3-2.1,38.1,12.3,42.1,32.1c0.6,2.7,0.6,5.6,0.6,8.4C79.3,276.4,79.3,304,79.3,331.7z"></path></svg> Android</a></li><li id="linkIos" class=""><a href="../../../ios/index.html"><svg viewbox="0 0 284 334"><path fill="#25B2DA" d="M209,334c-2.7,0-5.3,0-8,0c-9.5-3.6-19-7.1-28.4-11c-14.7-6.1-29.6-4.9-44.3-0.9c-11,3-21.6,7.8-32.3,11.8c-2.7,0-5.3,0-8,0c-16-3.4-27.8-13.1-37.5-25.4c-7.5-9.5-14.3-19.6-20.4-30.1C8.3,240.6-2.6,200.3,4,156.3c3.6-23.7,13.8-44,32.1-59.7c13-11.2,28.4-16.6,45.5-17.8c15.9-1.1,30.5,3.5,45,9.1c12.4,4.8,24.6,5.7,37.2,0.4c5.8-2.4,11.9-4,17.9-5.9c22.6-7.2,44.8-6.5,66.2,4.4c10.7,5.5,19.1,13.5,26.4,23c-55.8,41.3-44.2,112.9,8.8,133.9c-7.7,19.3-16.4,38.1-28.2,55.3C243.3,315.6,230.1,329.9,209,334z M141.4,80.9c-2.3-43.3,30.4-76.2,66.2-77.6C212.5,40.8,177.3,82.8,141.4,80.9z"></path></svg> ios</a></li></ul></div><div id="daumBody" class="divided"><div class="panel_search"><div id="boxSearch"><input type="text" id="query" class="tf_query" title="검색어 입력" placeholder="sample name.." name="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"> <button type="button" class="btn_reset"><span class="ico_del">검색어 지우기</span></button><div type="button" class="btn_dummy_search"><span class="ico_sch">검색하기</span></div></div></div><div id="daumSubmenu"><div data-depth1="지도" class="first"><strong>지도</strong><ul><li data-depth2="지도 생성하기"><a href="../basicMap/index.html">지도 생성하기</a></li><li data-depth2="지도 이동시키기"><a href="../moveMap/index.html">지도 이동시키기</a></li><li data-depth2="지도 레벨 바꾸기"><a href="../changeLevel/index.html">지도 레벨 바꾸기</a></li><li data-depth2="지도 정보 얻어오기"><a href="../mapInfo/index.html">지도 정보 얻어오기</a></li><li data-depth2="지도에 컨트롤 올리기"><a href="../addMapControl/index.html">지도에 컨트롤 올리기</a></li><li data-depth2="지도에 사용자 컨트롤 올리기"><a href="../addMapCustomControl/index.html">지도에 사용자 컨트롤 올리기</a></li><li data-depth2="지도 이동 막기"><a href="../disableMapDragMove/index.html">지도 이동 막기</a></li><li data-depth2="지도 확대 축소 막기"><a href="../enableDisableZoomInOut/index.html">지도 확대 축소 막기</a></li><li data-depth2="지도에 교통정보 표시하기"><a href="../addTrafficOverlay/index.html">지도에 교통정보 표시하기</a></li><li data-depth2="지도에 로드뷰 도로 표시하기"><a href="../addRoadviewOverlay/index.html">지도에 로드뷰 도로 표시하기</a></li><li data-depth2="지도에 지형도 표시하기"><a href="../addTerrainOverlay/index.html">지도에 지형도 표시하기</a></li><li data-depth2="지도 타입 바꾸기1"><a href="../changeOverlay1/index.html">지도 타입 바꾸기1</a></li><li data-depth2="지도 타입 바꾸기2"><a href="../changeOverlay2/index.html">지도 타입 바꾸기2</a></li><li data-depth2="지도 범위 재설정 하기"><a href="../setBounds/index.html">지도 범위 재설정 하기</a></li><li data-depth2="지도 영역 크기 동적 변경하기"><a href="../mapRelayout/index.html">지도 영역 크기 동적 변경하기</a></li><li data-depth2="클릭 이벤트 등록하기"><a href="../addMapClickEvent/index.html">클릭 이벤트 등록하기</a></li><li data-depth2="클릭한 위치에 마커 표시하기"><a href="../addMapClickEventWithMarker/index.html">클릭한 위치에 마커 표시하기</a></li><li data-depth2="이동 이벤트 등록하기"><a href="../addMapDragendEvent/index.html">이동 이벤트 등록하기</a></li><li data-depth2="확대, 축소 이벤트 등록하기"><a href="../addMapZoomChangedEvent/index.html">확대, 축소 이벤트 등록하기</a></li><li data-depth2="중심좌표 변경 이벤트 등록하기"><a href="../addMapCenterChangedEvent/index.html">중심좌표 변경 이벤트 등록하기</a></li><li data-depth2="영역 변경 이벤트 등록하기"><a href="../addMapBoundsChangedEvent/index.html">영역 변경 이벤트 등록하기</a></li><li data-depth2="타일로드 이벤트 등록하기"><a href="../addTilesloadedEvent/index.html">타일로드 이벤트 등록하기</a></li><li data-depth2="커스텀 타일셋1"><a href="../customTileset/index.html">커스텀 타일셋1</a></li><li data-depth2="커스텀 타일셋2"><a href="../getTile/index.html">커스텀 타일셋2</a></li></ul></div><div data-depth1="오버레이" class=""><strong>오버레이</strong><ul><li data-depth2="마커 생성하기"><a href="../basicMarker/index.html">마커 생성하기</a></li><li data-depth2="드래그 가능한 마커 생성하기"><a href="../draggableMarker/index.html">드래그 가능한 마커 생성하기</a></li><li data-depth2="다른 이미지로 마커 생성하기"><a href="../basicMarkerImage/index.html">다른 이미지로 마커 생성하기</a></li><li data-depth2="인포윈도우 생성하기"><a href="../basicInfoWindow/index.html">인포윈도우 생성하기</a></li><li data-depth2="마커에 인포윈도우 표시하기"><a href="../markerWithInfoWindow/index.html">마커에 인포윈도우 표시하기</a></li><li data-depth2="마커에 클릭 이벤트 등록하기"><a href="../addMarkerClickEvent/index.html">마커에 클릭 이벤트 등록하기</a></li><li data-depth2="마커에 마우스 이벤트 등록하기"><a href="../addMarkerMouseEvent/index.html">마커에 마우스 이벤트 등록하기</a></li><li data-depth2="draggable 마커 이벤트 적용하기"><a href="../addDraggableMarkerDragEvent/index.html">draggable 마커 이벤트 적용하기</a></li><li data-depth2="geolocation으로 마커 표시하기"><a href="../geolocationMarker/index.html">geolocation으로 마커 표시하기</a></li><li data-depth2="여러개 마커 표시하기"><a href="../multipleMarkerImage/index.html">여러개 마커 표시하기</a></li><li data-depth2="여러개 마커 제어하기"><a href="../multipleMarkerControl/index.html">여러개 마커 제어하기</a></li><li data-depth2="여러개 마커에 이벤트 등록하기1"><a href="../multipleMarkerEvent/index.html">여러개 마커에 이벤트 등록하기1</a></li><li data-depth2="여러개 마커에 이벤트 등록하기2"><a href="../multipleMarkerEvent2/index.html">여러개 마커에 이벤트 등록하기2</a></li><li data-depth2="다양한 이미지 마커 표시하기"><a href="../categoryMarker/index.html">다양한 이미지 마커 표시하기</a></li><li data-depth2="원, 선, 사각형, 다각형 표시하기"><a href="../drawShape/index.html">원, 선, 사각형, 다각형 표시하기</a></li><li data-depth2="선의 거리 계산하기"><a href="../calculatePolylineDistance/index.html">선의 거리 계산하기</a></li><li data-depth2="다각형의 면적 계산하기"><a href="../calculatePolygonArea/index.html">다각형의 면적 계산하기</a></li><li data-depth2="다각형에 이벤트 등록하기1"><a href="../addPolygonMouseEvent1/index.html">다각형에 이벤트 등록하기1</a></li><li data-depth2="다각형에 이벤트 등록하기2"><a href="../addPolygonMouseEvent2/index.html">다각형에 이벤트 등록하기2</a></li><li data-depth2="원의 반경 계산하기"><a href="../calculateCircleRadius/index.html">원의 반경 계산하기</a></li><li data-depth2="커스텀 오버레이 생성하기1"><a href="../customOverlay1/index.html">커스텀 오버레이 생성하기1</a></li><li data-depth2="커스텀 오버레이 생성하기2"><a href="../customOverlay2/index.html">커스텀 오버레이 생성하기2</a></li><li data-depth2="닫기가 가능한 커스텀 오버레이"><a href="../removableCustomOverlay/index.html">닫기가 가능한 커스텀 오버레이</a></li><li data-depth2="이미지 마커와 커스텀 오버레이"><a href="../markerWithCustomOverlay/index.html">이미지 마커와 커스텀 오버레이</a></li><li data-depth2="커스텀오버레이를 드래그 하기"><a href="../dragCustomOverlay/index.html">커스텀오버레이를 드래그 하기</a></li><li data-depth2="지도 영역 밖의 마커위치 추적하기"><a class="on" href="index.html">지도 영역 밖의 마커위치 추적하기</a></li><li data-depth2="구멍난 다각형 만들기"><a href="../donut/index.html">구멍난 다각형 만들기</a></li></ul></div><div data-depth1="로드뷰" class=""><strong>로드뷰</strong><ul><li data-depth2="로드뷰 생성하기"><a href="../basicRoadview/index.html">로드뷰 생성하기</a></li><li data-depth2="로드뷰 도로를 이용하여 로드뷰 생성하기"><a href="../basicRoadview2/index.html">로드뷰 도로를 이용하여 로드뷰 생성하기</a></li><li data-depth2="동동이를 이용하여 로드뷰와 지도 연동하기"><a href="../moveRoadview/index.html">동동이를 이용하여 로드뷰와 지도 연동하기</a></li><li data-depth2="로드뷰에 마커와 인포윈도우 올리기"><a href="../roadviewOverlay1/index.html">로드뷰에 마커와 인포윈도우 올리기</a></li><li data-depth2="마커의 고도와 반경 조절하기"><a href="../roadviewOverlay2/index.html">마커의 고도와 반경 조절하기</a></li><li data-depth2="로드뷰에 커스텀오버레이 올리기"><a href="../roadviewCustomOverlay/index.html">로드뷰에 커스텀오버레이 올리기</a></li><li data-depth2="로드뷰에 이미지 올리기"><a href="../roadviewImageOverlay/index.html">로드뷰에 이미지 올리기</a></li><li data-depth2="지도 위 버튼으로 로드뷰 표시하기"><a href="../roadviewWithMapButton/index.html">지도 위 버튼으로 로드뷰 표시하기</a></li><li data-depth2="로드뷰와 지도 토글하기"><a href="../roadviewToggle/index.html">로드뷰와 지도 토글하기</a></li></ul></div><div data-depth1="정적지도" class=""><strong>정적지도</strong><ul><li data-depth2="이미지 지도 생성하기"><a href="../staticMap/index.html">이미지 지도 생성하기</a></li><li data-depth2="이미지 지도에 마커 표시하기"><a href="../staticMapWithMarker/index.html">이미지 지도에 마커 표시하기</a></li><li data-depth2="마커와 텍스트 표시하기"><a href="../staticMapWithMarkerText/index.html">마커와 텍스트 표시하기</a></li></ul></div><div data-depth1="라이브러리" class=""><strong>라이브러리</strong><ul><li data-depth2="키워드로 장소검색하기"><a href="../keywordBasic/index.html">키워드로 장소검색하기</a></li><li data-depth2="키워드로 장소검색하고 목록으로 표출하기"><a href="../keywordList/index.html">키워드로 장소검색하고 목록으로 표출하기</a></li><li data-depth2="카테고리로 장소 검색하기"><a href="../categoryBasic/index.html">카테고리로 장소 검색하기</a></li><li data-depth2="카테고리별 장소 검색하기"><a href="../categoryFromBounds/index.html">카테고리별 장소 검색하기</a></li><li data-depth2="주소로 장소 표시하기"><a href="../addr2coord/index.html">주소로 장소 표시하기</a></li><li data-depth2="좌표로 주소를 얻어내기"><a href="../coord2addr/index.html">좌표로 주소를 얻어내기</a></li><li data-depth2="WTM 좌표를 WGS84 좌표로 변환하기"><a href="../transCoord/index.html">WTM 좌표를 WGS84 좌표로 변환하기</a></li><li data-depth2="마커 클러스터러 사용하기"><a href="../basicClusterer/index.html">마커 클러스터러 사용하기</a></li><li data-depth2="마커 클러스터러에 클릭이벤트 추가하기"><a href="../addClustererClickEvent/index.html">마커 클러스터러에 클릭이벤트 추가하기</a></li><li data-depth2="클러스터 마커에 텍스트 표시하기"><a href="../chickenClusterer/index.html">클러스터 마커에 텍스트 표시하기</a></li><li data-depth2="Drawing Library 사용하기"><a href="../basicDrawingLibrary/index.html">Drawing Library 사용하기</a></li><li data-depth2="Drawing Library에서 데이터 얻기"><a href="../drawingGetData/index.html">Drawing Library에서 데이터 얻기</a></li><li data-depth2="Toolbox 사용하기"><a href="../drawingToolbox/index.html">Toolbox 사용하기</a></li><li data-depth2="Drawing undo, redo"><a href="../drawingUndo/index.html">Drawing undo, redo</a></li></ul></div></div><div id="daumContent"><h2>지도 영역 밖의 마커위치 추적하기</h2><p>지도 영역 밖에 찍혀있는 마커의 방향을 지도상에 표현하고 싶을 경우가 있습니다. 이 예제에서는 지도 영역 밖에있는 마커의 위치를 추적하여 알려주는 기능을 구현하고 있습니다. Marker나 CustomOverlay는 지도 영역 밖에 위치하면 다시 영역안에 들어오기 전까지 자동으로 숨김처리 됩니다. 그렇기 때문에 보다 자연스러운 효과를 위해서 숨김처리 기능이 없는 AbstractOverlay를 사용하였습니다.</p><div id="map" style="width:100%;height:350px"></div><div class="wrap_tab"><![if gt ie 9]><a id="showLive" href="#" target="_blank" data-appkey="326e38503f420e1f0088dab1f46dc0c7" data-name="markerTracker">직접 해보기</a> <![endif]><h4 class="tab">Javascript</h4><div class="tabbody"><figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="cm">/**</span>
<span class="cm"> * AbstractOverlay를 상속받을 객체를 선언합니다.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">tooltipText</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">position</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">tooltip</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">tooltip</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;tooltip&#39;</span><span class="p">,</span>

    <span class="nx">tooltip</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">tooltipText</span><span class="p">));</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tooltip</span><span class="p">);</span>
    
    <span class="c1">// 툴팁 엘리먼트에 마우스 인터렉션에 따라 보임/숨김 기능을 하도록 이벤트를 등록합니다.</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">onmouseover</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">onmouseout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// AbstractOverlay 상속. 프로토타입 체인을 연결합니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">AbstractOverlay</span><span class="p">;</span>

<span class="c1">// AbstractOverlay의 필수 구현 메소드.</span>
<span class="c1">// setMap(map)을 호출했을 경우에 수행됩니다.</span>
<span class="c1">// AbstractOverlay의 getPanels() 메소드로 MapPanel 객체를 가져오고</span>
<span class="c1">// 거기에서 오버레이 레이어를 얻어 생성자에서 만든 엘리먼트를 자식 노드로 넣어줍니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onAdd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">panel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPanels</span><span class="p">().</span><span class="nx">overlayLayer</span><span class="p">;</span>
    <span class="nx">panel</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// AbstractOverlay의 필수 구현 메소드.</span>
<span class="c1">// setMap(null)을 호출했을 경우에 수행됩니다.</span>
<span class="c1">// 생성자에서 만든 엘리먼트를 오버레이 레이어에서 제거합니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onRemove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// AbstractOverlay의 필수 구현 메소드.</span>
<span class="c1">// 지도의 속성 값들이 변화할 때마다 호출됩니다. (zoom, center, mapType)</span>
<span class="c1">// 엘리먼트의 위치를 재조정 해 주어야 합니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 화면 좌표와 지도의 좌표를 매핑시켜주는 projection객체</span>
    <span class="kd">var</span> <span class="nx">projection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProjection</span><span class="p">();</span>
    
    <span class="c1">// overlayLayer는 지도와 함께 움직이는 layer이므로</span>
    <span class="c1">// 지도 내부의 위치를 반영해주는 pointFromCoords를 사용합니다.</span>
    <span class="kd">var</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">projection</span><span class="p">.</span><span class="nx">pointFromCoords</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>

    <span class="c1">// 내부 엘리먼트의 크기를 얻어서</span>
    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>

    <span class="c1">// 해당 위치의 정중앙에 위치하도록 top, left를 지정합니다.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">width</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">height</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// 좌표를 반환하는 메소드</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getPosition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * 지도 영역 외부에 존재하는 마커를 추적하는 기능을 가진 객체입니다.</span>
<span class="cm"> * 클리핑 알고리즘을 사용하여 tracker의 좌표를 구하고 있습니다.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 클리핑을 위한 outcode</span>
    <span class="kd">var</span> <span class="nx">OUTCODE</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">INSIDE</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span> <span class="c1">// 0b0000</span>
        <span class="nx">TOP</span><span class="o">:</span> <span class="mf">8</span><span class="p">,</span> <span class="c1">//0b1000</span>
        <span class="nx">RIGHT</span><span class="o">:</span> <span class="mf">2</span><span class="p">,</span> <span class="c1">// 0b0010</span>
        <span class="nx">BOTTOM</span><span class="o">:</span> <span class="mf">4</span><span class="p">,</span> <span class="c1">// 0b0100</span>
        <span class="nx">LEFT</span><span class="o">:</span> <span class="mf">1</span> <span class="c1">// 0b0001</span>
    <span class="p">};</span>
    
    <span class="c1">// viewport 영역을 구하기 위한 buffer값</span>
    <span class="c1">// target의 크기가 60x60 이므로 </span>
    <span class="c1">// 여기서는 지도 bounds에서 상하좌우 30px의 여분을 가진 bounds를 구하기 위해 사용합니다.</span>
    <span class="kd">var</span> <span class="nx">BOUNDS_BUFFER</span> <span class="o">=</span> <span class="mf">30</span><span class="p">;</span>
    
    <span class="c1">// 클리핑 알고리즘으로 tracker의 좌표를 구하기 위한 buffer값</span>
    <span class="c1">// 지도 bounds를 기준으로 상하좌우 buffer값 만큼 축소한 내부 사각형을 구하게 됩니다.</span>
    <span class="c1">// 그리고 그 사각형으로 target위치와 지도 중심 사이의 선을 클리핑 합니다.</span>
    <span class="c1">// 여기서는 tracker의 크기를 고려하여 40px로 잡습니다.</span>
    <span class="kd">var</span> <span class="nx">CLIP_BUFFER</span> <span class="o">=</span> <span class="mf">40</span><span class="p">;</span>

    <span class="c1">// trakcer 엘리먼트</span>
    <span class="kd">var</span> <span class="nx">tracker</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">tracker</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;tracker&#39;</span><span class="p">;</span>

    <span class="c1">// 내부 아이콘</span>
    <span class="kd">var</span> <span class="nx">icon</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">icon</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;icon&#39;</span><span class="p">;</span>

    <span class="c1">// 외부에 있는 target의 위치에 따라 회전하는 말풍선 모양의 엘리먼트</span>
    <span class="kd">var</span> <span class="nx">balloon</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">balloon</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;balloon&#39;</span><span class="p">;</span>

    <span class="nx">tracker</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">balloon</span><span class="p">);</span>
    <span class="nx">tracker</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">icon</span><span class="p">);</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">getNode</span><span class="p">().</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tracker</span><span class="p">);</span>

    <span class="c1">// traker를 클릭하면 target의 위치를 지도 중심으로 지정합니다.</span>
    <span class="nx">tracker</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">setCenter</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">());</span>
        <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="c1">// target의 위치를 추적하는 함수</span>
    <span class="kd">function</span> <span class="nx">tracking</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">proj</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">getProjection</span><span class="p">();</span>
        
        <span class="c1">// 지도의 영역을 구합니다.</span>
        <span class="kd">var</span> <span class="nx">bounds</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">getBounds</span><span class="p">();</span>
        
        <span class="c1">// 지도의 영역을 기준으로 확장된 영역을 구합니다.</span>
        <span class="kd">var</span> <span class="nx">extBounds</span> <span class="o">=</span> <span class="nx">extendBounds</span><span class="p">(</span><span class="nx">bounds</span><span class="p">,</span> <span class="nx">proj</span><span class="p">);</span>

        <span class="c1">// target이 확장된 영역에 속하는지 판단하고</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">extBounds</span><span class="p">.</span><span class="nx">contain</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">()))</span> <span class="p">{</span>
            <span class="c1">// 속하면 tracker를 숨깁니다.</span>
            <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// target이 영역 밖에 있으면 계산을 시작합니다.</span>
            

            <span class="c1">// 지도 bounds를 기준으로 클리핑할 top, right, bottom, left를 재계산합니다.</span>
            <span class="c1">//</span>
            <span class="c1">//  +-------------------------+</span>
            <span class="c1">//  | Map Bounds              |</span>
            <span class="c1">//  |   +-----------------+   |</span>
            <span class="c1">//  |   | Clipping Rect   |   |</span>
            <span class="c1">//  |   |                 |   |</span>
            <span class="c1">//  |   |        *       (A)  |     A</span>
            <span class="c1">//  |   |                 |   |</span>
            <span class="c1">//  |   |                 |   |</span>
            <span class="c1">//  |   +----(B)---------(C)  |</span>
            <span class="c1">//  |                         |</span>
            <span class="c1">//  +-------------------------+</span>
            <span class="c1">//</span>
            <span class="c1">//        B</span>
            <span class="c1">//</span>
            <span class="c1">//                                       C</span>
            <span class="c1">// * 은 지도의 중심,</span>
            <span class="c1">// A, B, C가 TooltipMarker의 위치,</span>
            <span class="c1">// (A), (B), (C)는 각 TooltipMarker에 대응하는 tracker입니다.</span>
            <span class="c1">// 지도 중심과 각 TooltipMarker를 연결하는 선분이 있다고 가정할 때,</span>
            <span class="c1">// 그 선분과 Clipping Rect와 만나는 지점의 좌표를 구해서</span>
            <span class="c1">// tracker의 위치(top, left)값을 지정해주려고 합니다.</span>
            <span class="c1">// tracker 자체의 크기가 있기 때문에 원래 지도 영역보다 안쪽의 가상 영역을 그려</span>
            <span class="c1">// 클리핑된 지점을 tracker의 위치로 사용합니다.</span>
            <span class="c1">// 실제 tracker의 position은 화면 좌표가 될 것이므로 </span>
            <span class="c1">// 계산을 위해 좌표 변환 메소드를 사용하여 모두 화면 좌표로 변환시킵니다.</span>
            
            <span class="c1">// TooltipMarker의 위치</span>
            <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">());</span>
            
            <span class="c1">// 지도 중심의 위치</span>
            <span class="kd">var</span> <span class="nx">center</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">map</span><span class="p">.</span><span class="nx">getCenter</span><span class="p">());</span>

            <span class="c1">// 현재 보이는 지도의 영역의 남서쪽 화면 좌표</span>
            <span class="kd">var</span> <span class="nx">sw</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getSouthWest</span><span class="p">());</span>
            
            <span class="c1">// 현재 보이는 지도의 영역의 북동쪽 화면 좌표</span>
            <span class="kd">var</span> <span class="nx">ne</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getNorthEast</span><span class="p">());</span>
            
            <span class="c1">// 클리핑할 가상의 내부 영역을 만듭니다.</span>
            <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">ne</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">ne</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">bottom</span> <span class="o">=</span> <span class="nx">sw</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">sw</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>

            <span class="c1">// 계산된 모든 좌표를 클리핑 로직에 넣어 좌표를 얻습니다.</span>
            <span class="kd">var</span> <span class="nx">clipPosition</span> <span class="o">=</span> <span class="nx">getClipPosition</span><span class="p">(</span><span class="nx">top</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">center</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
            
            <span class="c1">// 클리핑된 좌표를 tracker의 위치로 사용합니다.</span>
            <span class="nx">tracker</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">clipPosition</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
            <span class="nx">tracker</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">clipPosition</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>

            <span class="c1">// 말풍선의 회전각을 얻습니다.</span>
            <span class="kd">var</span> <span class="nx">angle</span> <span class="o">=</span> <span class="nx">getAngle</span><span class="p">(</span><span class="nx">center</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
            
            <span class="c1">// 회전각을 CSS transform을 사용하여 지정합니다.</span>
            <span class="c1">// 브라우저 종류에따라 표현되지 않을 수도 있습니다.</span>
            <span class="c1">// https://caniuse.com/#feat=transforms2d</span>
            <span class="nx">balloon</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cssText</span> <span class="o">+=</span>
                <span class="s1">&#39;-ms-transform: rotate(&#39;</span> <span class="o">+</span> <span class="nx">angle</span> <span class="o">+</span> <span class="s1">&#39;deg);&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;-webkit-transform: rotate(&#39;</span> <span class="o">+</span> <span class="nx">angle</span> <span class="o">+</span> <span class="s1">&#39;deg);&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;transform: rotate(&#39;</span> <span class="o">+</span> <span class="nx">angle</span> <span class="o">+</span> <span class="s1">&#39;deg);&#39;</span><span class="p">;</span>

            <span class="c1">// target이 영역 밖에 있을 경우 tracker를 노출합니다.</span>
            <span class="nx">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 상하좌우로 BOUNDS_BUFFER(30px)만큼 bounds를 확장 하는 함수</span>
    <span class="c1">//</span>
    <span class="c1">//  +-----------------------------+</span>
    <span class="c1">//  |              ^              |</span>
    <span class="c1">//  |              |              |</span>
    <span class="c1">//  |     +-----------------+     |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |  &lt;- |    Map Bounds   | -&gt;  |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |     +-----------------+     |</span>
    <span class="c1">//  |              |              |</span>
    <span class="c1">//  |              v              |</span>
    <span class="c1">//  +-----------------------------+</span>
    <span class="c1">//  </span>
    <span class="c1">// 여기서는 TooltipMaker가 완전히 안보이게 되는 시점의 영역을 구하기 위해서 사용됩니다.</span>
    <span class="c1">// TooltipMarker는 60x60 의 크기를 가지고 있기 때문에 </span>
    <span class="c1">// 지도에서 완전히 사라지려면 지도 영역을 상하좌우 30px만큼 더 드래그해야 합니다.</span>
    <span class="c1">// 이 함수는 현재 보이는 지도 bounds에서 상하좌우 30px만큼 확장한 bounds를 리턴합니다.</span>
    <span class="c1">// 이 확장된 영역은 TooltipMarker가 화면에서 보이는지를 판단하는 영역으로 사용됩니다.</span>
    <span class="kd">function</span> <span class="nx">extendBounds</span><span class="p">(</span><span class="nx">bounds</span><span class="p">,</span> <span class="nx">proj</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 주어진 bounds는 지도 좌표 정보로 표현되어 있습니다.</span>
        <span class="c1">// 이것을 BOUNDS_BUFFER 픽셀 만큼 확장하기 위해서는</span>
        <span class="c1">// 픽셀 단위인 화면 좌표로 변환해야 합니다.</span>
        <span class="kd">var</span> <span class="nx">sw</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">pointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getSouthWest</span><span class="p">());</span>
        <span class="kd">var</span> <span class="nx">ne</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">pointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getNorthEast</span><span class="p">());</span>

        <span class="c1">// 확장을 위해 각 좌표에 BOUNDS_BUFFER가 가진 수치만큼 더하거나 빼줍니다.</span>
        <span class="nx">sw</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>
        <span class="nx">sw</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>

        <span class="nx">ne</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>
        <span class="nx">ne</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>

        <span class="c1">// 그리고나서 다시 지도 좌표로 변환한 extBounds를 리턴합니다.</span>
        <span class="c1">// extBounds는 기존의 bounds에서 상하좌우 30px만큼 확장된 영역 객체입니다.  </span>
        <span class="k">return</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLngBounds</span><span class="p">(</span>
                        <span class="nx">proj</span><span class="p">.</span><span class="nx">coordsFromPoint</span><span class="p">(</span><span class="nx">sw</span><span class="p">),</span><span class="nx">proj</span><span class="p">.</span><span class="nx">coordsFromPoint</span><span class="p">(</span><span class="nx">ne</span><span class="p">));</span>
        
    <span class="p">}</span>


    <span class="c1">// Cohen–Sutherland clipping algorithm</span>
    <span class="c1">// 자세한 내용은 아래 위키에서...</span>
    <span class="c1">// https://en.wikipedia.org/wiki/Cohen%E2%80%93Sutherland_algorithm</span>
    <span class="kd">function</span> <span class="nx">getClipPosition</span><span class="p">(</span><span class="nx">top</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">inner</span><span class="p">,</span> <span class="nx">outer</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">function</span> <span class="nx">calcOutcode</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">outcode</span> <span class="o">=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">INSIDE</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">left</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">RIGHT</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">TOP</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">bottom</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">BOTTOM</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">outcode</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">ix</span> <span class="o">=</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">iy</span> <span class="o">=</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">ox</span> <span class="o">=</span> <span class="nx">outer</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">oy</span> <span class="o">=</span> <span class="nx">outer</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">calcOutcode</span><span class="p">(</span><span class="nx">ox</span><span class="p">,</span> <span class="nx">oy</span><span class="p">);</span>

        <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">TOP</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">ox</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">);</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">top</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">RIGHT</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">oy</span> <span class="o">+</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">right</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">);</span>        
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">right</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">BOTTOM</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">ox</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">bottom</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">);</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">bottom</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">oy</span> <span class="o">+</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">);</span>     
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">left</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">code</span> <span class="o">=</span> <span class="nx">calcOutcode</span><span class="p">(</span><span class="nx">ox</span><span class="p">,</span> <span class="nx">oy</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="nx">ox</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">oy</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// 말풍선의 회전각을 구하기 위한 함수</span>
    <span class="c1">// 말풍선의 anchor가 TooltipMarker가 있는 방향을 바라보도록 회전시킬 각을 구합니다.</span>
    <span class="kd">function</span> <span class="nx">getAngle</span><span class="p">(</span><span class="nx">center</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">target</span><span class="p">.</span><span class="nx">y</span> <span class="p">;</span>
        <span class="kd">var</span> <span class="nx">deg</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span> <span class="nx">dy</span> <span class="p">,</span> <span class="nx">dx</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">180</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span> 

        <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="nx">deg</span> <span class="o">+</span> <span class="mf">360</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360</span> <span class="o">|</span> <span class="mf">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">90</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// tracker의 보임/숨김을 지정하는 함수</span>
    <span class="kd">function</span> <span class="nx">setVisible</span><span class="p">(</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tracker</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">visible</span> <span class="o">?</span> <span class="s1">&#39;block&#39;</span> <span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Map 객체의 &#39;zoom_start&#39; 이벤트 핸들러</span>
    <span class="kd">function</span> <span class="nx">hideTracker</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// target의 추적을 실행합니다.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">run</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_start&#39;</span><span class="p">,</span> <span class="nx">hideTracker</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;center_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">tracking</span><span class="p">();</span>
    <span class="p">};</span>
    
    <span class="c1">// target의 추적을 중지합니다.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_start&#39;</span><span class="p">,</span> <span class="nx">hideTracker</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;center_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>


<span class="kd">var</span> <span class="nx">mapContainer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">),</span> <span class="c1">// 지도를 표시할 div </span>
<span class="nx">mapOption</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">center</span><span class="o">:</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.402054</span><span class="p">,</span> <span class="mf">127.1082099</span><span class="p">),</span> <span class="c1">// 지도의 중심좌표</span>
    <span class="nx">level</span><span class="o">:</span> <span class="mf">3</span> <span class="c1">// 지도의 확대 레벨</span>
<span class="p">};</span>

<span class="c1">// 지도를 생성합니다.</span>
<span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nb">Map</span><span class="p">(</span><span class="nx">mapContainer</span><span class="p">,</span> <span class="nx">mapOption</span><span class="p">);</span>

<span class="c1">// 본사</span>
<span class="kd">var</span> <span class="nx">dkpos1</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">33.450707</span><span class="p">,</span> <span class="mf">126.570678</span><span class="p">);</span>
<span class="c1">// 판교 오피스</span>
<span class="kd">var</span> <span class="nx">dkpos2</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.402054</span><span class="p">,</span> <span class="mf">127.108209</span><span class="p">);</span> 
<span class="c1">// 고객 센터</span>
<span class="kd">var</span> <span class="nx">dkpos3</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.402827</span><span class="p">,</span> <span class="mf">127.107292</span><span class="p">);</span>

<span class="c1">// 툴팁을 노출하는 마커를 생성합니다.</span>
<span class="kd">var</span> <span class="nx">marker1</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">dkpos1</span><span class="p">,</span> <span class="s1">&#39;kakao 본사&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">marker2</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">dkpos2</span><span class="p">,</span> <span class="s1">&#39;kakao 판교오피스&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">marker3</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">dkpos3</span><span class="p">,</span> <span class="s1">&#39;kakao 고객센터&#39;</span><span class="p">);</span>
<span class="nx">marker1</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="nx">marker2</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="nx">marker3</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// MarkerTracker를 생성합니다.</span>
<span class="kd">var</span> <span class="nx">markerTracker1</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">marker1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">markerTracker2</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">marker2</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">markerTracker3</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">marker3</span><span class="p">);</span>

<span class="c1">// marker의 추적을 시작합니다.</span>
<span class="nx">markerTracker1</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
<span class="nx">markerTracker2</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
<span class="nx">markerTracker3</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span></code></pre></figure></div><h4 class="tab off">Javascript + HTML</h4><div class="tabbody off"><figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>지도 영역 밖의 마커위치 추적하기<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">node</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/sign-info-64.png</span><span class="p">);</span>
    <span class="k">cursor</span><span class="p">:</span> <span class="kc">pointer</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">64</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">64</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">tooltip</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#333</span><span class="p">;</span>
    <span class="k">font-size</span><span class="p">:</span> <span class="mi">25</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">5</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">65</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">14</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">white-space</span><span class="p">:</span> <span class="kc">nowrap</span><span class="p">;</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">tracker</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">-35</span><span class="kt">px</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">-30</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
    <span class="k">cursor</span><span class="p">:</span> <span class="kc">pointer</span><span class="p">;</span>
    <span class="k">z-index</span><span class="p">:</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">icon</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">6</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">48</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">48</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/sign-info-48.png</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">balloon</span> <span class="p">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/balloon.png</span><span class="p">);</span>
    <span class="kp">-ms-</span><span class="k">transform-origin</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span> <span class="mi">34</span><span class="kt">px</span><span class="p">;</span>
    <span class="kp">-webkit-</span><span class="k">transform-origin</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span> <span class="mi">34</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">transform-origin</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span> <span class="mi">34</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width:100%;height:350px;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//dapi.kakao.com/v2/maps/sdk.js?appkey=발급받은 APP KEY를 사용하세요&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="cm">/**</span>
<span class="cm"> * AbstractOverlay를 상속받을 객체를 선언합니다.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">tooltipText</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">position</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">tooltip</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">tooltip</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;tooltip&#39;</span><span class="p">,</span>

    <span class="nx">tooltip</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">tooltipText</span><span class="p">));</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tooltip</span><span class="p">);</span>
    
    <span class="c1">// 툴팁 엘리먼트에 마우스 인터렉션에 따라 보임/숨김 기능을 하도록 이벤트를 등록합니다.</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">onmouseover</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">onmouseout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// AbstractOverlay 상속. 프로토타입 체인을 연결합니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">AbstractOverlay</span><span class="p">;</span>

<span class="c1">// AbstractOverlay의 필수 구현 메소드.</span>
<span class="c1">// setMap(map)을 호출했을 경우에 수행됩니다.</span>
<span class="c1">// AbstractOverlay의 getPanels() 메소드로 MapPanel 객체를 가져오고</span>
<span class="c1">// 거기에서 오버레이 레이어를 얻어 생성자에서 만든 엘리먼트를 자식 노드로 넣어줍니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onAdd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">panel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPanels</span><span class="p">().</span><span class="nx">overlayLayer</span><span class="p">;</span>
    <span class="nx">panel</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// AbstractOverlay의 필수 구현 메소드.</span>
<span class="c1">// setMap(null)을 호출했을 경우에 수행됩니다.</span>
<span class="c1">// 생성자에서 만든 엘리먼트를 오버레이 레이어에서 제거합니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onRemove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// AbstractOverlay의 필수 구현 메소드.</span>
<span class="c1">// 지도의 속성 값들이 변화할 때마다 호출됩니다. (zoom, center, mapType)</span>
<span class="c1">// 엘리먼트의 위치를 재조정 해 주어야 합니다.</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 화면 좌표와 지도의 좌표를 매핑시켜주는 projection객체</span>
    <span class="kd">var</span> <span class="nx">projection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProjection</span><span class="p">();</span>
    
    <span class="c1">// overlayLayer는 지도와 함께 움직이는 layer이므로</span>
    <span class="c1">// 지도 내부의 위치를 반영해주는 pointFromCoords를 사용합니다.</span>
    <span class="kd">var</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">projection</span><span class="p">.</span><span class="nx">pointFromCoords</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>

    <span class="c1">// 내부 엘리먼트의 크기를 얻어서</span>
    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>

    <span class="c1">// 해당 위치의 정중앙에 위치하도록 top, left를 지정합니다.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">width</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">height</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// 좌표를 반환하는 메소드</span>
<span class="nx">TooltipMarker</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getPosition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * 지도 영역 외부에 존재하는 마커를 추적하는 기능을 가진 객체입니다.</span>
<span class="cm"> * 클리핑 알고리즘을 사용하여 tracker의 좌표를 구하고 있습니다.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 클리핑을 위한 outcode</span>
    <span class="kd">var</span> <span class="nx">OUTCODE</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">INSIDE</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span> <span class="c1">// 0b0000</span>
        <span class="nx">TOP</span><span class="o">:</span> <span class="mf">8</span><span class="p">,</span> <span class="c1">//0b1000</span>
        <span class="nx">RIGHT</span><span class="o">:</span> <span class="mf">2</span><span class="p">,</span> <span class="c1">// 0b0010</span>
        <span class="nx">BOTTOM</span><span class="o">:</span> <span class="mf">4</span><span class="p">,</span> <span class="c1">// 0b0100</span>
        <span class="nx">LEFT</span><span class="o">:</span> <span class="mf">1</span> <span class="c1">// 0b0001</span>
    <span class="p">};</span>
    
    <span class="c1">// viewport 영역을 구하기 위한 buffer값</span>
    <span class="c1">// target의 크기가 60x60 이므로 </span>
    <span class="c1">// 여기서는 지도 bounds에서 상하좌우 30px의 여분을 가진 bounds를 구하기 위해 사용합니다.</span>
    <span class="kd">var</span> <span class="nx">BOUNDS_BUFFER</span> <span class="o">=</span> <span class="mf">30</span><span class="p">;</span>
    
    <span class="c1">// 클리핑 알고리즘으로 tracker의 좌표를 구하기 위한 buffer값</span>
    <span class="c1">// 지도 bounds를 기준으로 상하좌우 buffer값 만큼 축소한 내부 사각형을 구하게 됩니다.</span>
    <span class="c1">// 그리고 그 사각형으로 target위치와 지도 중심 사이의 선을 클리핑 합니다.</span>
    <span class="c1">// 여기서는 tracker의 크기를 고려하여 40px로 잡습니다.</span>
    <span class="kd">var</span> <span class="nx">CLIP_BUFFER</span> <span class="o">=</span> <span class="mf">40</span><span class="p">;</span>

    <span class="c1">// trakcer 엘리먼트</span>
    <span class="kd">var</span> <span class="nx">tracker</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">tracker</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;tracker&#39;</span><span class="p">;</span>

    <span class="c1">// 내부 아이콘</span>
    <span class="kd">var</span> <span class="nx">icon</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">icon</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;icon&#39;</span><span class="p">;</span>

    <span class="c1">// 외부에 있는 target의 위치에 따라 회전하는 말풍선 모양의 엘리먼트</span>
    <span class="kd">var</span> <span class="nx">balloon</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="nx">balloon</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;balloon&#39;</span><span class="p">;</span>

    <span class="nx">tracker</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">balloon</span><span class="p">);</span>
    <span class="nx">tracker</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">icon</span><span class="p">);</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">getNode</span><span class="p">().</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tracker</span><span class="p">);</span>

    <span class="c1">// traker를 클릭하면 target의 위치를 지도 중심으로 지정합니다.</span>
    <span class="nx">tracker</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">setCenter</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">());</span>
        <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="c1">// target의 위치를 추적하는 함수</span>
    <span class="kd">function</span> <span class="nx">tracking</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">proj</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">getProjection</span><span class="p">();</span>
        
        <span class="c1">// 지도의 영역을 구합니다.</span>
        <span class="kd">var</span> <span class="nx">bounds</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">getBounds</span><span class="p">();</span>
        
        <span class="c1">// 지도의 영역을 기준으로 확장된 영역을 구합니다.</span>
        <span class="kd">var</span> <span class="nx">extBounds</span> <span class="o">=</span> <span class="nx">extendBounds</span><span class="p">(</span><span class="nx">bounds</span><span class="p">,</span> <span class="nx">proj</span><span class="p">);</span>

        <span class="c1">// target이 확장된 영역에 속하는지 판단하고</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">extBounds</span><span class="p">.</span><span class="nx">contain</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">()))</span> <span class="p">{</span>
            <span class="c1">// 속하면 tracker를 숨깁니다.</span>
            <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// target이 영역 밖에 있으면 계산을 시작합니다.</span>
            

            <span class="c1">// 지도 bounds를 기준으로 클리핑할 top, right, bottom, left를 재계산합니다.</span>
            <span class="c1">//</span>
            <span class="c1">//  +-------------------------+</span>
            <span class="c1">//  | Map Bounds              |</span>
            <span class="c1">//  |   +-----------------+   |</span>
            <span class="c1">//  |   | Clipping Rect   |   |</span>
            <span class="c1">//  |   |                 |   |</span>
            <span class="c1">//  |   |        *       (A)  |     A</span>
            <span class="c1">//  |   |                 |   |</span>
            <span class="c1">//  |   |                 |   |</span>
            <span class="c1">//  |   +----(B)---------(C)  |</span>
            <span class="c1">//  |                         |</span>
            <span class="c1">//  +-------------------------+</span>
            <span class="c1">//</span>
            <span class="c1">//        B</span>
            <span class="c1">//</span>
            <span class="c1">//                                       C</span>
            <span class="c1">// * 은 지도의 중심,</span>
            <span class="c1">// A, B, C가 TooltipMarker의 위치,</span>
            <span class="c1">// (A), (B), (C)는 각 TooltipMarker에 대응하는 tracker입니다.</span>
            <span class="c1">// 지도 중심과 각 TooltipMarker를 연결하는 선분이 있다고 가정할 때,</span>
            <span class="c1">// 그 선분과 Clipping Rect와 만나는 지점의 좌표를 구해서</span>
            <span class="c1">// tracker의 위치(top, left)값을 지정해주려고 합니다.</span>
            <span class="c1">// tracker 자체의 크기가 있기 때문에 원래 지도 영역보다 안쪽의 가상 영역을 그려</span>
            <span class="c1">// 클리핑된 지점을 tracker의 위치로 사용합니다.</span>
            <span class="c1">// 실제 tracker의 position은 화면 좌표가 될 것이므로 </span>
            <span class="c1">// 계산을 위해 좌표 변환 메소드를 사용하여 모두 화면 좌표로 변환시킵니다.</span>
            
            <span class="c1">// TooltipMarker의 위치</span>
            <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">());</span>
            
            <span class="c1">// 지도 중심의 위치</span>
            <span class="kd">var</span> <span class="nx">center</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">map</span><span class="p">.</span><span class="nx">getCenter</span><span class="p">());</span>

            <span class="c1">// 현재 보이는 지도의 영역의 남서쪽 화면 좌표</span>
            <span class="kd">var</span> <span class="nx">sw</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getSouthWest</span><span class="p">());</span>
            
            <span class="c1">// 현재 보이는 지도의 영역의 북동쪽 화면 좌표</span>
            <span class="kd">var</span> <span class="nx">ne</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">containerPointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getNorthEast</span><span class="p">());</span>
            
            <span class="c1">// 클리핑할 가상의 내부 영역을 만듭니다.</span>
            <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">ne</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">ne</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">bottom</span> <span class="o">=</span> <span class="nx">sw</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">sw</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">CLIP_BUFFER</span><span class="p">;</span>

            <span class="c1">// 계산된 모든 좌표를 클리핑 로직에 넣어 좌표를 얻습니다.</span>
            <span class="kd">var</span> <span class="nx">clipPosition</span> <span class="o">=</span> <span class="nx">getClipPosition</span><span class="p">(</span><span class="nx">top</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">center</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
            
            <span class="c1">// 클리핑된 좌표를 tracker의 위치로 사용합니다.</span>
            <span class="nx">tracker</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">clipPosition</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
            <span class="nx">tracker</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">clipPosition</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>

            <span class="c1">// 말풍선의 회전각을 얻습니다.</span>
            <span class="kd">var</span> <span class="nx">angle</span> <span class="o">=</span> <span class="nx">getAngle</span><span class="p">(</span><span class="nx">center</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
            
            <span class="c1">// 회전각을 CSS transform을 사용하여 지정합니다.</span>
            <span class="c1">// 브라우저 종류에따라 표현되지 않을 수도 있습니다.</span>
            <span class="c1">// https://caniuse.com/#feat=transforms2d</span>
            <span class="nx">balloon</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cssText</span> <span class="o">+=</span>
                <span class="s1">&#39;-ms-transform: rotate(&#39;</span> <span class="o">+</span> <span class="nx">angle</span> <span class="o">+</span> <span class="s1">&#39;deg);&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;-webkit-transform: rotate(&#39;</span> <span class="o">+</span> <span class="nx">angle</span> <span class="o">+</span> <span class="s1">&#39;deg);&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;transform: rotate(&#39;</span> <span class="o">+</span> <span class="nx">angle</span> <span class="o">+</span> <span class="s1">&#39;deg);&#39;</span><span class="p">;</span>

            <span class="c1">// target이 영역 밖에 있을 경우 tracker를 노출합니다.</span>
            <span class="nx">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 상하좌우로 BOUNDS_BUFFER(30px)만큼 bounds를 확장 하는 함수</span>
    <span class="c1">//</span>
    <span class="c1">//  +-----------------------------+</span>
    <span class="c1">//  |              ^              |</span>
    <span class="c1">//  |              |              |</span>
    <span class="c1">//  |     +-----------------+     |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |  &lt;- |    Map Bounds   | -&gt;  |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |     |                 |     |</span>
    <span class="c1">//  |     +-----------------+     |</span>
    <span class="c1">//  |              |              |</span>
    <span class="c1">//  |              v              |</span>
    <span class="c1">//  +-----------------------------+</span>
    <span class="c1">//  </span>
    <span class="c1">// 여기서는 TooltipMaker가 완전히 안보이게 되는 시점의 영역을 구하기 위해서 사용됩니다.</span>
    <span class="c1">// TooltipMarker는 60x60 의 크기를 가지고 있기 때문에 </span>
    <span class="c1">// 지도에서 완전히 사라지려면 지도 영역을 상하좌우 30px만큼 더 드래그해야 합니다.</span>
    <span class="c1">// 이 함수는 현재 보이는 지도 bounds에서 상하좌우 30px만큼 확장한 bounds를 리턴합니다.</span>
    <span class="c1">// 이 확장된 영역은 TooltipMarker가 화면에서 보이는지를 판단하는 영역으로 사용됩니다.</span>
    <span class="kd">function</span> <span class="nx">extendBounds</span><span class="p">(</span><span class="nx">bounds</span><span class="p">,</span> <span class="nx">proj</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 주어진 bounds는 지도 좌표 정보로 표현되어 있습니다.</span>
        <span class="c1">// 이것을 BOUNDS_BUFFER 픽셀 만큼 확장하기 위해서는</span>
        <span class="c1">// 픽셀 단위인 화면 좌표로 변환해야 합니다.</span>
        <span class="kd">var</span> <span class="nx">sw</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">pointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getSouthWest</span><span class="p">());</span>
        <span class="kd">var</span> <span class="nx">ne</span> <span class="o">=</span> <span class="nx">proj</span><span class="p">.</span><span class="nx">pointFromCoords</span><span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">getNorthEast</span><span class="p">());</span>

        <span class="c1">// 확장을 위해 각 좌표에 BOUNDS_BUFFER가 가진 수치만큼 더하거나 빼줍니다.</span>
        <span class="nx">sw</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>
        <span class="nx">sw</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>

        <span class="nx">ne</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>
        <span class="nx">ne</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">BOUNDS_BUFFER</span><span class="p">;</span>

        <span class="c1">// 그리고나서 다시 지도 좌표로 변환한 extBounds를 리턴합니다.</span>
        <span class="c1">// extBounds는 기존의 bounds에서 상하좌우 30px만큼 확장된 영역 객체입니다.  </span>
        <span class="k">return</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLngBounds</span><span class="p">(</span>
                        <span class="nx">proj</span><span class="p">.</span><span class="nx">coordsFromPoint</span><span class="p">(</span><span class="nx">sw</span><span class="p">),</span><span class="nx">proj</span><span class="p">.</span><span class="nx">coordsFromPoint</span><span class="p">(</span><span class="nx">ne</span><span class="p">));</span>
        
    <span class="p">}</span>


    <span class="c1">// Cohen–Sutherland clipping algorithm</span>
    <span class="c1">// 자세한 내용은 아래 위키에서...</span>
    <span class="c1">// https://en.wikipedia.org/wiki/Cohen%E2%80%93Sutherland_algorithm</span>
    <span class="kd">function</span> <span class="nx">getClipPosition</span><span class="p">(</span><span class="nx">top</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">inner</span><span class="p">,</span> <span class="nx">outer</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">function</span> <span class="nx">calcOutcode</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">outcode</span> <span class="o">=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">INSIDE</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">left</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">RIGHT</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">TOP</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">bottom</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">outcode</span> <span class="o">|=</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">BOTTOM</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">outcode</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">ix</span> <span class="o">=</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">iy</span> <span class="o">=</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">ox</span> <span class="o">=</span> <span class="nx">outer</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">oy</span> <span class="o">=</span> <span class="nx">outer</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">calcOutcode</span><span class="p">(</span><span class="nx">ox</span><span class="p">,</span> <span class="nx">oy</span><span class="p">);</span>

        <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">TOP</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">ox</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">);</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">top</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">RIGHT</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">oy</span> <span class="o">+</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">right</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">);</span>        
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">right</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">BOTTOM</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">ox</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">bottom</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">);</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">bottom</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&amp;</span> <span class="nx">OUTCODE</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">oy</span> <span class="o">=</span> <span class="nx">oy</span> <span class="o">+</span> <span class="p">(</span><span class="nx">iy</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ix</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">);</span>     
                <span class="nx">ox</span> <span class="o">=</span> <span class="nx">left</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">code</span> <span class="o">=</span> <span class="nx">calcOutcode</span><span class="p">(</span><span class="nx">ox</span><span class="p">,</span> <span class="nx">oy</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="nx">ox</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">oy</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// 말풍선의 회전각을 구하기 위한 함수</span>
    <span class="c1">// 말풍선의 anchor가 TooltipMarker가 있는 방향을 바라보도록 회전시킬 각을 구합니다.</span>
    <span class="kd">function</span> <span class="nx">getAngle</span><span class="p">(</span><span class="nx">center</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">target</span><span class="p">.</span><span class="nx">y</span> <span class="p">;</span>
        <span class="kd">var</span> <span class="nx">deg</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span> <span class="nx">dy</span> <span class="p">,</span> <span class="nx">dx</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">180</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span> 

        <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="nx">deg</span> <span class="o">+</span> <span class="mf">360</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360</span> <span class="o">|</span> <span class="mf">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">90</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// tracker의 보임/숨김을 지정하는 함수</span>
    <span class="kd">function</span> <span class="nx">setVisible</span><span class="p">(</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tracker</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">visible</span> <span class="o">?</span> <span class="s1">&#39;block&#39;</span> <span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Map 객체의 &#39;zoom_start&#39; 이벤트 핸들러</span>
    <span class="kd">function</span> <span class="nx">hideTracker</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// target의 추적을 실행합니다.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">run</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_start&#39;</span><span class="p">,</span> <span class="nx">hideTracker</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;center_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">tracking</span><span class="p">();</span>
    <span class="p">};</span>
    
    <span class="c1">// target의 추적을 중지합니다.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_start&#39;</span><span class="p">,</span> <span class="nx">hideTracker</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;zoom_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;center_changed&#39;</span><span class="p">,</span> <span class="nx">tracking</span><span class="p">);</span>
        <span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>


<span class="kd">var</span> <span class="nx">mapContainer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">),</span> <span class="c1">// 지도를 표시할 div </span>
<span class="nx">mapOption</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">center</span><span class="o">:</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.402054</span><span class="p">,</span> <span class="mf">127.1082099</span><span class="p">),</span> <span class="c1">// 지도의 중심좌표</span>
    <span class="nx">level</span><span class="o">:</span> <span class="mf">3</span> <span class="c1">// 지도의 확대 레벨</span>
<span class="p">};</span>

<span class="c1">// 지도를 생성합니다.</span>
<span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nb">Map</span><span class="p">(</span><span class="nx">mapContainer</span><span class="p">,</span> <span class="nx">mapOption</span><span class="p">);</span>

<span class="c1">// 본사</span>
<span class="kd">var</span> <span class="nx">dkpos1</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">33.450707</span><span class="p">,</span> <span class="mf">126.570678</span><span class="p">);</span>
<span class="c1">// 판교 오피스</span>
<span class="kd">var</span> <span class="nx">dkpos2</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.402054</span><span class="p">,</span> <span class="mf">127.108209</span><span class="p">);</span> 
<span class="c1">// 고객 센터</span>
<span class="kd">var</span> <span class="nx">dkpos3</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">kakao</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.402827</span><span class="p">,</span> <span class="mf">127.107292</span><span class="p">);</span>

<span class="c1">// 툴팁을 노출하는 마커를 생성합니다.</span>
<span class="kd">var</span> <span class="nx">marker1</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">dkpos1</span><span class="p">,</span> <span class="s1">&#39;kakao 본사&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">marker2</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">dkpos2</span><span class="p">,</span> <span class="s1">&#39;kakao 판교오피스&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">marker3</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">TooltipMarker</span><span class="p">(</span><span class="nx">dkpos3</span><span class="p">,</span> <span class="s1">&#39;kakao 고객센터&#39;</span><span class="p">);</span>
<span class="nx">marker1</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="nx">marker2</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="nx">marker3</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// MarkerTracker를 생성합니다.</span>
<span class="kd">var</span> <span class="nx">markerTracker1</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">marker1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">markerTracker2</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">marker2</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">markerTracker3</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">MarkerTracker</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="nx">marker3</span><span class="p">);</span>

<span class="c1">// marker의 추적을 시작합니다.</span>
<span class="nx">markerTracker1</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
<span class="nx">markerTracker2</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
<span class="nx">markerTracker3</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span></code></pre></figure></div></div></div></div><div id="liveWrap"><div class="close"></div><iframe id="liveFrame"></iframe></div><div id="dimmedLayer" style="height:0"></div><script type="text/javascript" src="../../../../m1.daumcdn.net/tiara/js/td.min.js"></script><script type="text/javascript">var _tiq = 'undefined' !== typeof _tiq ? _tiq : [];
    window._tiq = _tiq;
    _tiq.push(['__trackPageview']);</script><script type="text/javascript" src="../../../../t1.daumcdn.net/mapapisdoc/cssjs/1643022782389/js/service.min.js"></script><script>/**
 * AbstractOverlay를 상속받을 객체를 선언합니다.
 */
function TooltipMarker(position, tooltipText) {
    this.position = position;
    var node = this.node = document.createElement('div');
    node.className = 'node';

    var tooltip = document.createElement('div');
    tooltip.className = 'tooltip',

    tooltip.appendChild(document.createTextNode(tooltipText));
    node.appendChild(tooltip);
    
    // 툴팁 엘리먼트에 마우스 인터렉션에 따라 보임/숨김 기능을 하도록 이벤트를 등록합니다.
    node.onmouseover = function() {
        tooltip.style.display = 'block';
    };
    node.onmouseout = function() {
        tooltip.style.display = 'none';
    };
}

// AbstractOverlay 상속. 프로토타입 체인을 연결합니다.
TooltipMarker.prototype = new kakao.maps.AbstractOverlay;

// AbstractOverlay의 필수 구현 메소드.
// setMap(map)을 호출했을 경우에 수행됩니다.
// AbstractOverlay의 getPanels() 메소드로 MapPanel 객체를 가져오고
// 거기에서 오버레이 레이어를 얻어 생성자에서 만든 엘리먼트를 자식 노드로 넣어줍니다.
TooltipMarker.prototype.onAdd = function() {
    var panel = this.getPanels().overlayLayer;
    panel.appendChild(this.node);
};

// AbstractOverlay의 필수 구현 메소드.
// setMap(null)을 호출했을 경우에 수행됩니다.
// 생성자에서 만든 엘리먼트를 오버레이 레이어에서 제거합니다.
TooltipMarker.prototype.onRemove = function() {
    this.node.parentNode.removeChild(this.node);
};

// AbstractOverlay의 필수 구현 메소드.
// 지도의 속성 값들이 변화할 때마다 호출됩니다. (zoom, center, mapType)
// 엘리먼트의 위치를 재조정 해 주어야 합니다.
TooltipMarker.prototype.draw = function() {
    // 화면 좌표와 지도의 좌표를 매핑시켜주는 projection객체
    var projection = this.getProjection();
    
    // overlayLayer는 지도와 함께 움직이는 layer이므로
    // 지도 내부의 위치를 반영해주는 pointFromCoords를 사용합니다.
    var point = projection.pointFromCoords(this.position);

    // 내부 엘리먼트의 크기를 얻어서
    var width = this.node.offsetWidth;
    var height = this.node.offsetHeight;

    // 해당 위치의 정중앙에 위치하도록 top, left를 지정합니다.
    this.node.style.left = (point.x - width/2) + "px";
    this.node.style.top = (point.y - height/2) + "px";
};

// 좌표를 반환하는 메소드
TooltipMarker.prototype.getPosition = function() {
    return this.position;
};

/**
 * 지도 영역 외부에 존재하는 마커를 추적하는 기능을 가진 객체입니다.
 * 클리핑 알고리즘을 사용하여 tracker의 좌표를 구하고 있습니다.
 */
function MarkerTracker(map, target) {
    // 클리핑을 위한 outcode
    var OUTCODE = {
        INSIDE: 0, // 0b0000
        TOP: 8, //0b1000
        RIGHT: 2, // 0b0010
        BOTTOM: 4, // 0b0100
        LEFT: 1 // 0b0001
    };
    
    // viewport 영역을 구하기 위한 buffer값
    // target의 크기가 60x60 이므로 
    // 여기서는 지도 bounds에서 상하좌우 30px의 여분을 가진 bounds를 구하기 위해 사용합니다.
    var BOUNDS_BUFFER = 30;
    
    // 클리핑 알고리즘으로 tracker의 좌표를 구하기 위한 buffer값
    // 지도 bounds를 기준으로 상하좌우 buffer값 만큼 축소한 내부 사각형을 구하게 됩니다.
    // 그리고 그 사각형으로 target위치와 지도 중심 사이의 선을 클리핑 합니다.
    // 여기서는 tracker의 크기를 고려하여 40px로 잡습니다.
    var CLIP_BUFFER = 40;

    // trakcer 엘리먼트
    var tracker = document.createElement('div');
    tracker.className = 'tracker';

    // 내부 아이콘
    var icon = document.createElement('div');
    icon.className = 'icon';

    // 외부에 있는 target의 위치에 따라 회전하는 말풍선 모양의 엘리먼트
    var balloon = document.createElement('div');
    balloon.className = 'balloon';

    tracker.appendChild(balloon);
    tracker.appendChild(icon);

    map.getNode().appendChild(tracker);

    // traker를 클릭하면 target의 위치를 지도 중심으로 지정합니다.
    tracker.onclick = function() {
        map.setCenter(target.getPosition());
        setVisible(false);
    };

    // target의 위치를 추적하는 함수
    function tracking() {
        var proj = map.getProjection();
        
        // 지도의 영역을 구합니다.
        var bounds = map.getBounds();
        
        // 지도의 영역을 기준으로 확장된 영역을 구합니다.
        var extBounds = extendBounds(bounds, proj);

        // target이 확장된 영역에 속하는지 판단하고
        if (extBounds.contain(target.getPosition())) {
            // 속하면 tracker를 숨깁니다.
            setVisible(false);
        } else {
            // target이 영역 밖에 있으면 계산을 시작합니다.
            

            // 지도 bounds를 기준으로 클리핑할 top, right, bottom, left를 재계산합니다.
            //
            //  +-------------------------+
            //  | Map Bounds              |
            //  |   +-----------------+   |
            //  |   | Clipping Rect   |   |
            //  |   |                 |   |
            //  |   |        *       (A)  |     A
            //  |   |                 |   |
            //  |   |                 |   |
            //  |   +----(B)---------(C)  |
            //  |                         |
            //  +-------------------------+
            //
            //        B
            //
            //                                       C
            // * 은 지도의 중심,
            // A, B, C가 TooltipMarker의 위치,
            // (A), (B), (C)는 각 TooltipMarker에 대응하는 tracker입니다.
            // 지도 중심과 각 TooltipMarker를 연결하는 선분이 있다고 가정할 때,
            // 그 선분과 Clipping Rect와 만나는 지점의 좌표를 구해서
            // tracker의 위치(top, left)값을 지정해주려고 합니다.
            // tracker 자체의 크기가 있기 때문에 원래 지도 영역보다 안쪽의 가상 영역을 그려
            // 클리핑된 지점을 tracker의 위치로 사용합니다.
            // 실제 tracker의 position은 화면 좌표가 될 것이므로 
            // 계산을 위해 좌표 변환 메소드를 사용하여 모두 화면 좌표로 변환시킵니다.
            
            // TooltipMarker의 위치
            var pos = proj.containerPointFromCoords(target.getPosition());
            
            // 지도 중심의 위치
            var center = proj.containerPointFromCoords(map.getCenter());

            // 현재 보이는 지도의 영역의 남서쪽 화면 좌표
            var sw = proj.containerPointFromCoords(bounds.getSouthWest());
            
            // 현재 보이는 지도의 영역의 북동쪽 화면 좌표
            var ne = proj.containerPointFromCoords(bounds.getNorthEast());
            
            // 클리핑할 가상의 내부 영역을 만듭니다.
            var top = ne.y + CLIP_BUFFER;
            var right = ne.x - CLIP_BUFFER;
            var bottom = sw.y - CLIP_BUFFER;
            var left = sw.x + CLIP_BUFFER;

            // 계산된 모든 좌표를 클리핑 로직에 넣어 좌표를 얻습니다.
            var clipPosition = getClipPosition(top, right, bottom, left, center, pos);
            
            // 클리핑된 좌표를 tracker의 위치로 사용합니다.
            tracker.style.top = clipPosition.y + 'px';
            tracker.style.left = clipPosition.x + 'px';

            // 말풍선의 회전각을 얻습니다.
            var angle = getAngle(center, pos);
            
            // 회전각을 CSS transform을 사용하여 지정합니다.
            // 브라우저 종류에따라 표현되지 않을 수도 있습니다.
            // https://caniuse.com/#feat=transforms2d
            balloon.style.cssText +=
                '-ms-transform: rotate(' + angle + 'deg);' +
                '-webkit-transform: rotate(' + angle + 'deg);' +
                'transform: rotate(' + angle + 'deg);';

            // target이 영역 밖에 있을 경우 tracker를 노출합니다.
            setVisible(true);
        }
    }

    // 상하좌우로 BOUNDS_BUFFER(30px)만큼 bounds를 확장 하는 함수
    //
    //  +-----------------------------+
    //  |              ^              |
    //  |              |              |
    //  |     +-----------------+     |
    //  |     |                 |     |
    //  |     |                 |     |
    //  |  <- |    Map Bounds   | ->  |
    //  |     |                 |     |
    //  |     |                 |     |
    //  |     +-----------------+     |
    //  |              |              |
    //  |              v              |
    //  +-----------------------------+
    //  
    // 여기서는 TooltipMaker가 완전히 안보이게 되는 시점의 영역을 구하기 위해서 사용됩니다.
    // TooltipMarker는 60x60 의 크기를 가지고 있기 때문에 
    // 지도에서 완전히 사라지려면 지도 영역을 상하좌우 30px만큼 더 드래그해야 합니다.
    // 이 함수는 현재 보이는 지도 bounds에서 상하좌우 30px만큼 확장한 bounds를 리턴합니다.
    // 이 확장된 영역은 TooltipMarker가 화면에서 보이는지를 판단하는 영역으로 사용됩니다.
    function extendBounds(bounds, proj) {
        // 주어진 bounds는 지도 좌표 정보로 표현되어 있습니다.
        // 이것을 BOUNDS_BUFFER 픽셀 만큼 확장하기 위해서는
        // 픽셀 단위인 화면 좌표로 변환해야 합니다.
        var sw = proj.pointFromCoords(bounds.getSouthWest());
        var ne = proj.pointFromCoords(bounds.getNorthEast());

        // 확장을 위해 각 좌표에 BOUNDS_BUFFER가 가진 수치만큼 더하거나 빼줍니다.
        sw.x -= BOUNDS_BUFFER;
        sw.y += BOUNDS_BUFFER;

        ne.x += BOUNDS_BUFFER;
        ne.y -= BOUNDS_BUFFER;

        // 그리고나서 다시 지도 좌표로 변환한 extBounds를 리턴합니다.
        // extBounds는 기존의 bounds에서 상하좌우 30px만큼 확장된 영역 객체입니다.  
        return new kakao.maps.LatLngBounds(
                        proj.coordsFromPoint(sw),proj.coordsFromPoint(ne));
        
    }


    // Cohen–Sutherland clipping algorithm
    // 자세한 내용은 아래 위키에서...
    // https://en.wikipedia.org/wiki/Cohen%E2%80%93Sutherland_algorithm
    function getClipPosition(top, right, bottom, left, inner, outer) {
        function calcOutcode(x, y) {
            var outcode = OUTCODE.INSIDE;

            if (x < left) {
                outcode |= OUTCODE.LEFT;
            } else if (x > right) {
                outcode |= OUTCODE.RIGHT;
            }

            if (y < top) {
                outcode |= OUTCODE.TOP;
            } else if (y > bottom) {
                outcode |= OUTCODE.BOTTOM;
            }

            return outcode;
        }

        var ix = inner.x;
        var iy = inner.y;
        var ox = outer.x;
        var oy = outer.y;

        var code = calcOutcode(ox, oy);

        while(true) {
            if (!code) {
                break;
            }

            if (code & OUTCODE.TOP) {
                ox = ox + (ix - ox) / (iy - oy) * (top - oy);
                oy = top;
            } else if (code & OUTCODE.RIGHT) {
                oy = oy + (iy - oy) / (ix - ox) * (right - ox);        
                ox = right;
            } else if (code & OUTCODE.BOTTOM) {
                ox = ox + (ix - ox) / (iy - oy) * (bottom - oy);
                oy = bottom;
            } else if (code & OUTCODE.LEFT) {
                oy = oy + (iy - oy) / (ix - ox) * (left - ox);     
                ox = left;
            }

            code = calcOutcode(ox, oy);
        }

        return {x: ox, y: oy};
    }

    // 말풍선의 회전각을 구하기 위한 함수
    // 말풍선의 anchor가 TooltipMarker가 있는 방향을 바라보도록 회전시킬 각을 구합니다.
    function getAngle(center, target) {
        var dx = target.x - center.x;
        var dy = center.y - target.y ;
        var deg = Math.atan2( dy , dx ) * 180 / Math.PI; 

        return ((-deg + 360) % 360 | 0) + 90;
    }
    
    // tracker의 보임/숨김을 지정하는 함수
    function setVisible(visible) {
        tracker.style.display = visible ? 'block' : 'none';
    }
    
    // Map 객체의 'zoom_start' 이벤트 핸들러
    function hideTracker() {
        setVisible(false);
    }
    
    // target의 추적을 실행합니다.
    this.run = function() {
        kakao.maps.event.addListener(map, 'zoom_start', hideTracker);
        kakao.maps.event.addListener(map, 'zoom_changed', tracking);
        kakao.maps.event.addListener(map, 'center_changed', tracking);
        tracking();
    };
    
    // target의 추적을 중지합니다.
    this.stop = function() {
        kakao.maps.event.removeListener(map, 'zoom_start', hideTracker);
        kakao.maps.event.removeListener(map, 'zoom_changed', tracking);
        kakao.maps.event.removeListener(map, 'center_changed', tracking);
        setVisible(false);
    };
}


var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
mapOption = {
    center: new kakao.maps.LatLng(37.402054, 127.1082099), // 지도의 중심좌표
    level: 3 // 지도의 확대 레벨
};

// 지도를 생성합니다.
var map = new kakao.maps.Map(mapContainer, mapOption);

// 본사
var dkpos1 = new kakao.maps.LatLng(33.450707, 126.570678);
// 판교 오피스
var dkpos2 = new kakao.maps.LatLng(37.402054, 127.108209); 
// 고객 센터
var dkpos3 = new kakao.maps.LatLng(37.402827, 127.107292);

// 툴팁을 노출하는 마커를 생성합니다.
var marker1 = new TooltipMarker(dkpos1, 'kakao 본사');
var marker2 = new TooltipMarker(dkpos2, 'kakao 판교오피스');
var marker3 = new TooltipMarker(dkpos3, 'kakao 고객센터');
marker1.setMap(map);
marker2.setMap(map);
marker3.setMap(map);

// MarkerTracker를 생성합니다.
var markerTracker1 = new MarkerTracker(map, marker1);
var markerTracker2 = new MarkerTracker(map, marker2);
var markerTracker3 = new MarkerTracker(map, marker3);

// marker의 추적을 시작합니다.
markerTracker1.run();
markerTracker2.run();
markerTracker3.run();</script></body>
<!-- Mirrored from apis.map.kakao.com/web/sample/markerTracker/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 31 May 2022 05:12:42 GMT -->
</html>